# v3 é…ç½®è§„èŒƒ

> **æ–‡ä»¶**: specs/rules/é…ç½®è§„èŒƒ.md  
> **ç‰ˆæœ¬**: v3.0  
> **æ—¥æœŸ**: 2025-11-20  
> **è¯´æ˜**: é…ç½®æ–‡ä»¶çš„ç®¡ç†è§„èŒƒ

---

## ğŸ“‹ é…ç½®æ–‡ä»¶ç±»å‹

### ç¯å¢ƒé…ç½®

```yaml
.env æ–‡ä»¶ï¼ˆç¦æ­¢æäº¤ï¼‰:
  - .env: æœ¬åœ°å¼€å‘ç¯å¢ƒ
  - .env.local: æœ¬åœ°è¦†ç›–é…ç½®
  - .env.development: å¼€å‘ç¯å¢ƒï¼ˆå¯æäº¤æ¨¡æ¿ï¼‰
  - .env.test: æµ‹è¯•ç¯å¢ƒ
  - .env.staging: é¢„å‘å¸ƒç¯å¢ƒ
  - .env.production: ç”Ÿäº§ç¯å¢ƒ

.env.exampleï¼ˆå¿…é¡»æäº¤ï¼‰:
  - æä¾›æ‰€æœ‰ç¯å¢ƒå˜é‡çš„æ¨¡æ¿
  - ä¸åŒ…å«çœŸå®å€¼
  - åŒ…å«æ³¨é‡Šè¯´æ˜
```

### åº”ç”¨é…ç½®

```yaml
configs/ ç›®å½•:
  - config.json: é»˜è®¤é…ç½®
  - config.dev.json: å¼€å‘ç¯å¢ƒé…ç½®
  - config.test.json: æµ‹è¯•ç¯å¢ƒé…ç½®
  - config.staging.json: é¢„å‘å¸ƒç¯å¢ƒé…ç½®
  - config.prod.json: ç”Ÿäº§ç¯å¢ƒé…ç½®

package.json:
  - é¡¹ç›®å…ƒä¿¡æ¯
  - ä¾èµ–ç®¡ç†
  - è„šæœ¬å‘½ä»¤

tsconfig.json / jsconfig.json:
  - TypeScript/JavaScript é…ç½®

.eslintrc.json:
  - ä»£ç æ£€æŸ¥è§„åˆ™

.prettierrc.json:
  - ä»£ç æ ¼å¼åŒ–è§„åˆ™
```

---

## ğŸ”’ ç¯å¢ƒå˜é‡è§„èŒƒ

### .env æ–‡ä»¶æ ¼å¼

```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=myapp
DB_USER=admin
DB_PASSWORD=your_secure_password_here

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# APIå¯†é’¥ï¼ˆç¦æ­¢æäº¤çœŸå®å¯†é’¥ï¼‰
STRIPE_API_KEY=sk_test_xxxxxxxxxxxxxxxxxxxx
GOOGLE_API_KEY=AIzaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# JWTé…ç½®
JWT_SECRET=your_jwt_secret_here
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d

# åº”ç”¨é…ç½®
NODE_ENV=development
PORT=3000
API_URL=http://localhost:3000
FRONTEND_URL=http://localhost:8080

# æ—¥å¿—é…ç½®
LOG_LEVEL=debug
LOG_FILE=logs/app.log

# é‚®ä»¶é…ç½®
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=no-reply@example.com
SMTP_PASSWORD=your_smtp_password

# ç¬¬ä¸‰æ–¹æœåŠ¡
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_REGION=us-east-1
```

### .env.example æ¨¡æ¿

```env
# =================================
# ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º .env å¹¶å¡«å…¥å®é™…å€¼
# =================================

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=
DB_USER=
DB_PASSWORD=

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# APIå¯†é’¥
STRIPE_API_KEY=
GOOGLE_API_KEY=

# JWTé…ç½®
JWT_SECRET=
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d

# åº”ç”¨é…ç½®
NODE_ENV=development
PORT=3000
API_URL=
FRONTEND_URL=

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
LOG_FILE=logs/app.log

# é‚®ä»¶é…ç½®
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=

# ç¬¬ä¸‰æ–¹æœåŠ¡
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=us-east-1
```

### å‘½åè§„èŒƒ

```yaml
ç¯å¢ƒå˜é‡å‘½å:
  æ ¼å¼: UPPER_SNAKE_CASE
  ç¤ºä¾‹: DB_HOST, API_KEY, JWT_SECRET

åˆ†ç»„:
  ä½¿ç”¨å‰ç¼€åˆ†ç»„ç›¸å…³é…ç½®:
    DB_*: æ•°æ®åº“ç›¸å…³
    REDIS_*: Redisç›¸å…³
    JWT_*: JWTç›¸å…³
    SMTP_*: é‚®ä»¶ç›¸å…³
    AWS_*: AWSç›¸å…³

å¸ƒå°”å€¼:
  ä½¿ç”¨: true/false
  ç¤ºä¾‹: ENABLE_CACHE=true

æ•°å­—:
  ä¸ä½¿ç”¨å¼•å·
  ç¤ºä¾‹: PORT=3000

å­—ç¬¦ä¸²:
  å¯é€‰å¼•å·
  ç¤ºä¾‹: DB_NAME=myapp æˆ– DB_NAME="myapp"
```

---

## ğŸ“„ åº”ç”¨é…ç½®è§„èŒƒ

### config.json ç»“æ„

```json
{
  "app": {
    "name": "MyApp",
    "version": "1.0.0",
    "env": "development"
  },
  "server": {
    "port": 3000,
    "host": "localhost",
    "cors": {
      "enabled": true,
      "origins": ["http://localhost:8080"]
    }
  },
  "database": {
    "type": "postgres",
    "host": "localhost",
    "port": 5432,
    "name": "myapp",
    "pool": {
      "min": 2,
      "max": 10
    },
    "ssl": false
  },
  "redis": {
    "host": "localhost",
    "port": 6379,
    "db": 0,
    "keyPrefix": "myapp:"
  },
  "jwt": {
    "expiresIn": "24h",
    "refreshExpiresIn": "7d",
    "issuer": "myapp"
  },
  "logging": {
    "level": "info",
    "format": "json",
    "output": ["console", "file"],
    "file": "logs/app.log"
  },
  "cache": {
    "enabled": true,
    "ttl": 3600,
    "maxSize": 1000
  },
  "rateLimit": {
    "enabled": true,
    "windowMs": 900000,
    "max": 100
  }
}
```

### ç¯å¢ƒç‰¹å®šé…ç½®

```json
// config.dev.json
{
  "app": {
    "env": "development"
  },
  "server": {
    "port": 3000
  },
  "database": {
    "host": "localhost",
    "name": "myapp_dev",
    "ssl": false
  },
  "logging": {
    "level": "debug"
  }
}

// config.prod.json
{
  "app": {
    "env": "production"
  },
  "server": {
    "port": 8080,
    "cors": {
      "origins": ["https://example.com"]
    }
  },
  "database": {
    "ssl": true,
    "pool": {
      "min": 10,
      "max": 50
    }
  },
  "logging": {
    "level": "warn",
    "format": "json"
  }
}
```

### é…ç½®åŠ è½½é¡ºåº

```yaml
åŠ è½½é¡ºåºï¼ˆåè€…è¦†ç›–å‰è€…ï¼‰:
  1. config.jsonï¼ˆé»˜è®¤é…ç½®ï¼‰
  2. config.{env}.jsonï¼ˆç¯å¢ƒç‰¹å®šé…ç½®ï¼‰
  3. ç¯å¢ƒå˜é‡ï¼ˆ.envæ–‡ä»¶ï¼‰
  4. å‘½ä»¤è¡Œå‚æ•°

ç¤ºä¾‹:
  const config = {
    ...defaultConfig,
    ...envConfig,
    ...processEnv,
    ...cliArgs
  };
```

---

## ğŸ” æ•æ„Ÿä¿¡æ¯ç®¡ç†

### ç¦æ­¢ç¡¬ç¼–ç 

```yaml
âŒ ç¦æ­¢åœ¨é…ç½®æ–‡ä»¶ä¸­ç¡¬ç¼–ç :
  - å¯†ç 
  - APIå¯†é’¥
  - æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼ˆå«å¯†ç ï¼‰
  - ç§é’¥
  - åŠ å¯†å¯†é’¥
  - ç”Ÿäº§ç¯å¢ƒURL

âœ… å¿…é¡»ä½¿ç”¨ç¯å¢ƒå˜é‡:
  const password = process.env.DB_PASSWORD;
  const apiKey = process.env.STRIPE_API_KEY;
```

### .gitignore é…ç½®

```gitignore
# ç¯å¢ƒå˜é‡æ–‡ä»¶
.env
.env.local
.env.*.local

# ä¸è¦å¿½ç•¥ç¤ºä¾‹æ–‡ä»¶
!.env.example

# æ—¥å¿—æ–‡ä»¶
logs/
*.log

# ä¸´æ—¶æ–‡ä»¶
tmp/
temp/
.cache/

# ä¾èµ–
node_modules/

# æ„å»ºäº§ç‰©
dist/
build/

# IDEé…ç½®
.vscode/
.idea/
*.swp
*.swo

# OSæ–‡ä»¶
.DS_Store
Thumbs.db
```

### å¯†é’¥ç®¡ç†æœ€ä½³å®è·µ

```yaml
å¼€å‘ç¯å¢ƒ:
  - ä½¿ç”¨ .env æ–‡ä»¶
  - ä¸æäº¤åˆ°Git

æµ‹è¯•ç¯å¢ƒ:
  - ä½¿ç”¨CI/CDé…ç½®çš„ç¯å¢ƒå˜é‡
  - æˆ–ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡

ç”Ÿäº§ç¯å¢ƒ:
  - ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡:
    - AWS Secrets Manager
    - Azure Key Vault
    - HashiCorp Vault
  - ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆå®¹å™¨/äº‘å¹³å°ï¼‰
  - å®šæœŸè½®æ¢å¯†é’¥
```

---

## âš™ï¸ é…ç½®éªŒè¯

### å¯åŠ¨æ—¶éªŒè¯

```javascript
// config/validator.js

const requiredEnvVars = [
  'DB_HOST',
  'DB_PORT',
  'DB_NAME',
  'DB_USER',
  'DB_PASSWORD',
  'JWT_SECRET',
  'REDIS_HOST'
];

function validateConfig() {
  const missing = [];
  
  for (const varName of requiredEnvVars) {
    if (!process.env[varName]) {
      missing.push(varName);
    }
  }
  
  if (missing.length > 0) {
    throw new Error(
      `Missing required environment variables: ${missing.join(', ')}\n` +
      `Please check your .env file.`
    );
  }
  
  // éªŒè¯æ ¼å¼
  const port = parseInt(process.env.DB_PORT);
  if (isNaN(port) || port < 1 || port > 65535) {
    throw new Error('DB_PORT must be a valid port number');
  }
  
  // éªŒè¯æšä¸¾å€¼
  const validEnvs = ['development', 'test', 'staging', 'production'];
  if (!validEnvs.includes(process.env.NODE_ENV)) {
    throw new Error(`NODE_ENV must be one of: ${validEnvs.join(', ')}`);
  }
}

module.exports = { validateConfig };
```

### é…ç½®Schema

```javascript
// config/schema.js

const Joi = require('joi');

const configSchema = Joi.object({
  app: Joi.object({
    name: Joi.string().required(),
    version: Joi.string().pattern(/^\d+\.\d+\.\d+$/).required(),
    env: Joi.string().valid('development', 'test', 'staging', 'production').required()
  }),
  server: Joi.object({
    port: Joi.number().port().required(),
    host: Joi.string().hostname().required(),
    cors: Joi.object({
      enabled: Joi.boolean().required(),
      origins: Joi.array().items(Joi.string().uri())
    })
  }),
  database: Joi.object({
    type: Joi.string().valid('postgres', 'mysql', 'mongodb').required(),
    host: Joi.string().hostname().required(),
    port: Joi.number().port().required(),
    name: Joi.string().required(),
    pool: Joi.object({
      min: Joi.number().min(1).required(),
      max: Joi.number().min(1).required()
    })
  })
});

function validateConfigSchema(config) {
  const { error, value } = configSchema.validate(config);
  if (error) {
    throw new Error(`Config validation error: ${error.message}`);
  }
  return value;
}

module.exports = { validateConfigSchema };
```

---

## ğŸ“ é…ç½®æ–‡æ¡£

### é…ç½®è¯´æ˜æ–‡æ¡£

```markdown
# é…ç½®è¯´æ˜

## ç¯å¢ƒå˜é‡

### æ•°æ®åº“é…ç½®

| å˜é‡å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| DB_HOST | string | æ˜¯ | - | æ•°æ®åº“ä¸»æœºåœ°å€ |
| DB_PORT | number | æ˜¯ | - | æ•°æ®åº“ç«¯å£ |
| DB_NAME | string | æ˜¯ | - | æ•°æ®åº“åç§° |
| DB_USER | string | æ˜¯ | - | æ•°æ®åº“ç”¨æˆ·å |
| DB_PASSWORD | string | æ˜¯ | - | æ•°æ®åº“å¯†ç  |

### Redisé…ç½®

| å˜é‡å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| REDIS_HOST | string | æ˜¯ | localhost | Redisä¸»æœºåœ°å€ |
| REDIS_PORT | number | å¦ | 6379 | Redisç«¯å£ |
| REDIS_PASSWORD | string | å¦ | - | Rediså¯†ç  |

### JWTé…ç½®

| å˜é‡å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|------|--------|------|
| JWT_SECRET | string | æ˜¯ | - | JWTç­¾åå¯†é’¥ |
| JWT_EXPIRES_IN | string | å¦ | 24h | Tokenè¿‡æœŸæ—¶é—´ |
| JWT_REFRESH_EXPIRES_IN | string | å¦ | 7d | RefreshTokenè¿‡æœŸæ—¶é—´ |

## åº”ç”¨é…ç½®

### serveré…ç½®

\`\`\`json
{
  "server": {
    "port": 3000,         // æœåŠ¡å™¨ç«¯å£
    "host": "localhost",  // æœåŠ¡å™¨ä¸»æœº
    "cors": {
      "enabled": true,    // æ˜¯å¦å¯ç”¨CORS
      "origins": []       // å…è®¸çš„æº
    }
  }
}
\`\`\`

### loggingé…ç½®

\`\`\`json
{
  "logging": {
    "level": "info",      // æ—¥å¿—çº§åˆ«: debug/info/warn/error
    "format": "json",     // æ—¥å¿—æ ¼å¼: json/text
    "output": ["console"] // è¾“å‡ºç›®æ ‡: console/file
  }
}
\`\`\`
```

---

## ğŸ”„ é…ç½®æ›´æ–°æµç¨‹

### Intent-09: é…ç½®ä¿®æ”¹

```yaml
æ‰§è¡Œæµç¨‹:
  STEP 5-7: åˆ†æå’Œç¡®è®¤
    1. åˆ†æé…ç½®éœ€æ±‚
    2. ç”Ÿæˆé…ç½®æ–¹æ¡ˆ
    3. ç”¨æˆ·ç¡®è®¤æ–¹æ¡ˆ
  
  STEP 9: ä¿®æ”¹é…ç½®æ–‡ä»¶
    - configs/config.{env}.json
    - .env.exampleï¼ˆå¦‚æœæ–°å¢ç¯å¢ƒå˜é‡ï¼‰
  
  STEP 10: ç”¨æˆ·ç¡®è®¤é…ç½®
  
  STEP 15: æ›´æ–°æ–‡æ¡£
    - æ›´æ–°é…ç½®è¯´æ˜æ–‡æ¡£
    - æ›´æ–°README.mdï¼ˆå¦‚æœéœ€è¦ï¼‰
  
  STEP 17: éªŒè¯é…ç½®
    - éªŒè¯JSONæ ¼å¼
    - éªŒè¯é…ç½®schema
    - éªŒè¯ç¯å¢ƒå˜é‡
```

### é…ç½®å˜æ›´æ£€æŸ¥

```yaml
å˜æ›´å‰æ£€æŸ¥:
  - âœ… é…ç½®é¡¹æ˜¯å¦å·²å­˜åœ¨
  - âœ… é»˜è®¤å€¼æ˜¯å¦åˆç†
  - âœ… æ˜¯å¦å½±å“ç°æœ‰åŠŸèƒ½
  - âœ… æ˜¯å¦éœ€è¦è¿ç§»

å˜æ›´åéªŒè¯:
  - âœ… JSONæ ¼å¼æ­£ç¡®
  - âœ… SchemaéªŒè¯é€šè¿‡
  - âœ… åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨
  - âœ… åŠŸèƒ½æµ‹è¯•é€šè¿‡
```

---

## ğŸ“Š é…ç½®æœ€ä½³å®è·µ

### é…ç½®åˆ†å±‚

```yaml
ä¸‰å±‚é…ç½®:
  1. é»˜è®¤é…ç½®ï¼ˆconfig.jsonï¼‰
     - é€šç”¨é…ç½®
     - å¼€å‘å‹å¥½çš„é»˜è®¤å€¼
  
  2. ç¯å¢ƒé…ç½®ï¼ˆconfig.{env}.jsonï¼‰
     - ç¯å¢ƒç‰¹å®šçš„å€¼
     - è¦†ç›–é»˜è®¤é…ç½®
  
  3. è¿è¡Œæ—¶é…ç½®ï¼ˆç¯å¢ƒå˜é‡ï¼‰
     - æ•æ„Ÿä¿¡æ¯
     - éƒ¨ç½²æ—¶çš„åŠ¨æ€å€¼
     - è¦†ç›–æ‰€æœ‰é…ç½®
```

### é…ç½®ç±»å‹

```yaml
ä¸‰ç§ç±»å‹:
  1. é™æ€é…ç½®ï¼ˆæäº¤åˆ°Gitï¼‰
     - åº”ç”¨åç§°
     - ç‰ˆæœ¬å·
     - é»˜è®¤ç«¯å£
     - åŠŸèƒ½å¼€å…³é»˜è®¤å€¼
  
  2. ç¯å¢ƒç‰¹å®šé…ç½®ï¼ˆæäº¤åˆ°Gitï¼‰
     - æ—¥å¿—çº§åˆ«
     - è¿æ¥æ± å¤§å°
     - è¶…æ—¶æ—¶é—´
  
  3. æ•æ„Ÿé…ç½®ï¼ˆä¸æäº¤åˆ°Gitï¼‰
     - å¯†ç 
     - APIå¯†é’¥
     - æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
```

### é…ç½®åŸåˆ™

```yaml
åŸåˆ™:
  1. çº¦å®šä¼˜äºé…ç½®
     - æä¾›åˆç†çš„é»˜è®¤å€¼
     - å‡å°‘å¿…éœ€é…ç½®é¡¹
  
  2. ç¯å¢ƒåˆ†ç¦»
     - å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒéš”ç¦»
     - ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶
  
  3. å®‰å…¨ç¬¬ä¸€
     - æ•æ„Ÿä¿¡æ¯ä¸æäº¤
     - ä½¿ç”¨ç¯å¢ƒå˜é‡
     - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡
  
  4. éªŒè¯ä¼˜å…ˆ
     - å¯åŠ¨æ—¶éªŒè¯é…ç½®
     - å¤±è´¥å¿«é€Ÿï¼ˆFail Fastï¼‰
     - æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
  
  5. æ–‡æ¡£å®Œæ•´
     - æ‰€æœ‰é…ç½®é¡¹éƒ½æœ‰è¯´æ˜
     - .env.example å®Œæ•´
     - æ›´æ–°åŠæ—¶
```

---

## ğŸ› ï¸ é…ç½®å·¥å…·

### æ¨èå·¥å…·

```yaml
ç¯å¢ƒå˜é‡ç®¡ç†:
  - dotenv: åŠ è½½.envæ–‡ä»¶
  - dotenv-expand: æ”¯æŒå˜é‡å±•å¼€
  - dotenv-safe: éªŒè¯å¿…éœ€å˜é‡

é…ç½®éªŒè¯:
  - joi: SchemaéªŒè¯
  - ajv: JSON SchemaéªŒè¯
  - yup: å¯¹è±¡éªŒè¯

é…ç½®ç®¡ç†:
  - config: å¤šç¯å¢ƒé…ç½®ç®¡ç†
  - nconf: åˆ†å±‚é…ç½®
  - convict: é…ç½®éªŒè¯å’Œæ–‡æ¡£

å¯†é’¥ç®¡ç†:
  - aws-sdk (Secrets Manager)
  - @azure/keyvault-secrets
  - vault: HashiCorp Vaultå®¢æˆ·ç«¯
```

### ä½¿ç”¨ç¤ºä¾‹

```javascript
// åŠ è½½ç¯å¢ƒå˜é‡
require('dotenv').config();

// åŠ è½½é…ç½®
const config = require('config');

// éªŒè¯é…ç½®
const { validateConfig } = require('./config/validator');
validateConfig();

// ä½¿ç”¨é…ç½®
const dbConfig = config.get('database');
const connection = createConnection(dbConfig);
```

---

**æ–‡ä»¶åˆ›å»º**: 2025-11-20  
**æœ€åæ›´æ–°**: 2025-11-20  
**çŠ¶æ€**: âœ… å®Œæ•´

