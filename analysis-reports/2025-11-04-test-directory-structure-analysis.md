# æµ‹è¯•æ–‡ä»¶ç»„ç»‡è§„èŒƒåˆ†æ

**åˆ†ææ—¥æœŸ**: 2025-11-04  
**åˆ†æèŒƒå›´**: test/ ç›®å½•ç»“æ„è§„èŒƒ  
**é—®é¢˜**: logger.test.jsã€errors.test.js ç­‰åŸºç¡€è®¾æ–½æµ‹è¯•æ–‡ä»¶ä¸åŠŸèƒ½æ€§æµ‹è¯•æ–‡ä»¶æ··åœ¨ä¸€èµ·

---

## ğŸ“Š é—®é¢˜åˆ†æ

### å½“å‰çŠ¶æ€

**monSQLize é¡¹ç›®å®é™…æƒ…å†µ**:
```
test/unit/
  â”œâ”€ aggregate.test.js        # åŠŸèƒ½æµ‹è¯•
  â”œâ”€ count.test.js            # åŠŸèƒ½æµ‹è¯•
  â”œâ”€ find.test.js             # åŠŸèƒ½æµ‹è¯•
  â”œâ”€ findPage.test.js         # åŠŸèƒ½æµ‹è¯•
  â”œâ”€ connection.test.js       # åŸºç¡€è®¾æ–½æµ‹è¯•
  â”œâ”€ logger.test.js           # åŸºç¡€è®¾æ–½æµ‹è¯• âŒ
  â””â”€ errors.test.js           # åŸºç¡€è®¾æ–½æµ‹è¯• âŒ
```

**é—®é¢˜**:
- âš ï¸ åŸºç¡€è®¾æ–½æµ‹è¯•ä¸åŠŸèƒ½æµ‹è¯•æ··åœ¨ä¸€èµ·
- âš ï¸ éš¾ä»¥åŒºåˆ†æµ‹è¯•ç±»å‹
- âš ï¸ ä¸åˆ©äºæµ‹è¯•ç»„ç»‡å’Œç»´æŠ¤

### æµ‹è¯•æ–‡ä»¶åˆ†ç±»

#### 1. åŠŸèƒ½æ€§æµ‹è¯•ï¼ˆFeature Testsï¼‰
æµ‹è¯•ä¸šåŠ¡åŠŸèƒ½ã€API æ–¹æ³•

**ç‰¹ç‚¹**:
- æµ‹è¯•å…·ä½“çš„ä¸šåŠ¡åŠŸèƒ½
- å¯¹å¤–æš´éœ²çš„ API
- ç”¨æˆ·ç›´æ¥ä½¿ç”¨çš„åŠŸèƒ½

**ç¤ºä¾‹**:
- find.test.js - æµ‹è¯•æŸ¥è¯¢åŠŸèƒ½
- count.test.js - æµ‹è¯•è®¡æ•°åŠŸèƒ½
- aggregate.test.js - æµ‹è¯•èšåˆåŠŸèƒ½
- findPage.test.js - æµ‹è¯•åˆ†é¡µåŠŸèƒ½

#### 2. åŸºç¡€è®¾æ–½æµ‹è¯•ï¼ˆInfrastructure Testsï¼‰
æµ‹è¯•åº•å±‚å·¥å…·ã€è¾…åŠ©æ¨¡å—

**ç‰¹ç‚¹**:
- æµ‹è¯•åº•å±‚æ”¯æ’‘èƒ½åŠ›
- å†…éƒ¨ä½¿ç”¨çš„å·¥å…·ç±»
- è·¨åŠŸèƒ½çš„åŸºç¡€è®¾æ–½

**ç¤ºä¾‹**:
- logger.test.js - æµ‹è¯•æ—¥å¿—ç³»ç»Ÿ
- errors.test.js - æµ‹è¯•é”™è¯¯ç ç³»ç»Ÿ
- cache.test.js - æµ‹è¯•ç¼“å­˜æœºåˆ¶
- connection.test.js - æµ‹è¯•è¿æ¥ç®¡ç†
- config.test.js - æµ‹è¯•é…ç½®ç®¡ç†
- validator.test.js - æµ‹è¯•è¾“å…¥æ ¡éªŒ

#### 3. å·¥å…·å‡½æ•°æµ‹è¯•ï¼ˆUtility Testsï¼‰
æµ‹è¯•çº¯å·¥å…·å‡½æ•°

**ç‰¹ç‚¹**:
- æµ‹è¯•çº¯å‡½æ•°
- æ— å‰¯ä½œç”¨
- å¯å¤ç”¨çš„å·¥å…·

**ç¤ºä¾‹**:
- utils.test.js - æµ‹è¯•å·¥å…·å‡½æ•°
- helpers.test.js - æµ‹è¯•è¾…åŠ©å‡½æ•°
- formatters.test.js - æµ‹è¯•æ ¼å¼åŒ–å‡½æ•°

---

## ğŸ’¡ æ¨èæ–¹æ¡ˆ

### æ–¹æ¡ˆ A: æŒ‰æµ‹è¯•ç±»å‹åˆ†å­ç›®å½•ï¼ˆæ¨èï¼‰

```
test/
  â”œâ”€ unit/
  â”‚  â”œâ”€ features/                 # åŠŸèƒ½æ€§æµ‹è¯•
  â”‚  â”‚  â”œâ”€ find.test.js
  â”‚  â”‚  â”œâ”€ count.test.js
  â”‚  â”‚  â”œâ”€ aggregate.test.js
  â”‚  â”‚  â””â”€ findPage.test.js
  â”‚  â”œâ”€ infrastructure/           # åŸºç¡€è®¾æ–½æµ‹è¯•
  â”‚  â”‚  â”œâ”€ logger.test.js
  â”‚  â”‚  â”œâ”€ errors.test.js
  â”‚  â”‚  â”œâ”€ connection.test.js
  â”‚  â”‚  â””â”€ cache.test.js
  â”‚  â””â”€ utils/                    # å·¥å…·å‡½æ•°æµ‹è¯•
  â”‚     â”œâ”€ helpers.test.js
  â”‚     â””â”€ formatters.test.js
  â”œâ”€ integration/
  â””â”€ e2e/
```

**ä¼˜åŠ¿**:
- âœ… æ¸…æ™°åˆ†ç±»ï¼Œæ˜“äºæŸ¥æ‰¾
- âœ… èŒè´£æ˜ç¡®ï¼Œæ˜“äºç»´æŠ¤
- âœ… ä¾¿äºå•ç‹¬è¿è¡ŒæŸç±»æµ‹è¯•
- âœ… ç¬¦åˆè½¯ä»¶åˆ†å±‚æ€æƒ³

**åŠ£åŠ¿**:
- âš ï¸ ç›®å½•å±‚çº§å¢åŠ 
- âš ï¸ éœ€è¦è¿ç§»ç°æœ‰æ–‡ä»¶

---

### æ–¹æ¡ˆ B: æŒ‰æ¨¡å—/åŠŸèƒ½åŸŸåˆ†å­ç›®å½•ï¼ˆå¤‡é€‰ï¼‰

```
test/
  â”œâ”€ unit/
  â”‚  â”œâ”€ query/                    # æŸ¥è¯¢ç›¸å…³
  â”‚  â”‚  â”œâ”€ find.test.js
  â”‚  â”‚  â”œâ”€ count.test.js
  â”‚  â”‚  â””â”€ aggregate.test.js
  â”‚  â”œâ”€ pagination/               # åˆ†é¡µç›¸å…³
  â”‚  â”‚  â””â”€ findPage.test.js
  â”‚  â”œâ”€ connection/               # è¿æ¥ç›¸å…³
  â”‚  â”‚  â””â”€ connection.test.js
  â”‚  â””â”€ core/                     # æ ¸å¿ƒåŸºç¡€è®¾æ–½
  â”‚     â”œâ”€ logger.test.js
  â”‚     â”œâ”€ errors.test.js
  â”‚     â””â”€ cache.test.js
  â”œâ”€ integration/
  â””â”€ e2e/
```

**ä¼˜åŠ¿**:
- âœ… æŒ‰ä¸šåŠ¡é¢†åŸŸåˆ†ç»„
- âœ… åŠŸèƒ½å†…èšæ€§å¼º

**åŠ£åŠ¿**:
- âš ï¸ é¢†åŸŸåˆ’åˆ†å¯èƒ½ä¸æ˜ç¡®
- âš ï¸ åŸºç¡€è®¾æ–½ä»å¯èƒ½åˆ†æ•£

---

### æ–¹æ¡ˆ C: å¹³é“º + å‘½åå‰ç¼€ï¼ˆä¸æ¨èï¼‰

```
test/unit/
  â”œâ”€ feature-find.test.js
  â”œâ”€ feature-count.test.js
  â”œâ”€ infra-logger.test.js
  â”œâ”€ infra-errors.test.js
  â””â”€ util-helpers.test.js
```

**ä¼˜åŠ¿**:
- âœ… æ— éœ€å­ç›®å½•
- âœ… æ–‡ä»¶æ‰å¹³åŒ–

**åŠ£åŠ¿**:
- âŒ æ–‡ä»¶åå†—é•¿
- âŒ ä¸ç¬¦åˆå¸¸è§å®è·µ
- âŒ éš¾ä»¥ç»„ç»‡å¤§é‡æµ‹è¯•

---

## ğŸ“‹ è§„èŒƒæ›´æ–°å»ºè®®

### å»ºè®®ï¼šé‡‡ç”¨æ–¹æ¡ˆ Aï¼ˆæŒ‰æµ‹è¯•ç±»å‹åˆ†å­ç›®å½•ï¼‰

**æ›´æ–°ç¬¬21ç« "éªŒè¯ä»£ç ç›®å½•ç»“æ„"**:

```markdown
**æ ‡å‡†ç›®å½•ç»“æ„**ï¼ˆè¯¦ç»†ç‰ˆï¼‰:
```
<é¡¹ç›®>/
â”œâ”€ test/                         # æµ‹è¯•ä»£ç ï¼ˆå¼ºåˆ¶ï¼‰
â”‚  â”œâ”€ unit/                      # å•å…ƒæµ‹è¯•ï¼ˆå¼ºåˆ¶ï¼‰
â”‚  â”‚  â”œâ”€ features/               # åŠŸèƒ½æ€§æµ‹è¯•ï¼ˆä¸šåŠ¡åŠŸèƒ½ï¼‰
â”‚  â”‚  â”‚  â”œâ”€ <åŠŸèƒ½>.test.js
â”‚  â”‚  â”‚  â””â”€ ...
â”‚  â”‚  â”œâ”€ infrastructure/         # åŸºç¡€è®¾æ–½æµ‹è¯•ï¼ˆåº•å±‚æ”¯æ’‘ï¼‰
â”‚  â”‚  â”‚  â”œâ”€ logger.test.js
â”‚  â”‚  â”‚  â”œâ”€ errors.test.js
â”‚  â”‚  â”‚  â”œâ”€ connection.test.js
â”‚  â”‚  â”‚  â”œâ”€ cache.test.js
â”‚  â”‚  â”‚  â””â”€ config.test.js
â”‚  â”‚  â””â”€ utils/                  # å·¥å…·å‡½æ•°æµ‹è¯•ï¼ˆçº¯å‡½æ•°ï¼‰
â”‚  â”‚     â”œâ”€ helpers.test.js
â”‚  â”‚     â””â”€ formatters.test.js
â”‚  â”œâ”€ integration/               # é›†æˆæµ‹è¯•ï¼ˆæ¨èï¼‰
â”‚  â”‚  â”œâ”€ <åœºæ™¯>.integration.test.js
â”‚  â”‚  â””â”€ ...
â”‚  â””â”€ e2e/                       # ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
â”‚     â”œâ”€ <æµç¨‹>.e2e.test.js
â”‚     â””â”€ ...
â”œâ”€ examples/                     # ç¤ºä¾‹éªŒè¯ï¼ˆå¼ºåˆ¶ï¼‰
â”œâ”€ benchmarks/                   # æ€§èƒ½æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
â””â”€ coverage/                     # è¦†ç›–ç‡æŠ¥å‘Šï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
```

**æµ‹è¯•åˆ†ç±»æ ‡å‡†**:

| æµ‹è¯•ç±»å‹ | ç›®å½• | æµ‹è¯•å¯¹è±¡ | ç¤ºä¾‹ |
|---------|------|---------|------|
| **åŠŸèƒ½æ€§æµ‹è¯•** | test/unit/features/ | ä¸šåŠ¡åŠŸèƒ½ã€å¯¹å¤–API | find.test.js, count.test.js |
| **åŸºç¡€è®¾æ–½æµ‹è¯•** | test/unit/infrastructure/ | åº•å±‚æ”¯æ’‘ã€å†…éƒ¨å·¥å…· | logger.test.js, errors.test.js |
| **å·¥å…·å‡½æ•°æµ‹è¯•** | test/unit/utils/ | çº¯å‡½æ•°ã€è¾…åŠ©å·¥å…· | helpers.test.js, formatters.test.js |
| **é›†æˆæµ‹è¯•** | test/integration/ | è·¨æ¨¡å—äº¤äº’ | pagination-flow.integration.test.js |
| **ç«¯åˆ°ç«¯æµ‹è¯•** | test/e2e/ | å®Œæ•´ç”¨æˆ·æµç¨‹ | user-query-flow.e2e.test.js |

**åˆ†ç±»åˆ¤æ–­æ ‡å‡†**:

```yaml
åŠŸèƒ½æ€§æµ‹è¯• (features/):
  - æµ‹è¯•å¯¹å¤–æš´éœ²çš„ API/æ–¹æ³•
  - æµ‹è¯•ä¸šåŠ¡åŠŸèƒ½
  - ç”¨æˆ·ç›´æ¥ä½¿ç”¨çš„åŠŸèƒ½
  
åŸºç¡€è®¾æ–½æµ‹è¯• (infrastructure/):
  - æµ‹è¯•æ—¥å¿—ç³»ç»Ÿ (logger.test.js)
  - æµ‹è¯•é”™è¯¯ç ç³»ç»Ÿ (errors.test.js)
  - æµ‹è¯•è¿æ¥ç®¡ç† (connection.test.js)
  - æµ‹è¯•ç¼“å­˜æœºåˆ¶ (cache.test.js)
  - æµ‹è¯•é…ç½®ç®¡ç† (config.test.js)
  - æµ‹è¯•è¾“å…¥æ ¡éªŒå™¨ (validator.test.js)
  
å·¥å…·å‡½æ•°æµ‹è¯• (utils/):
  - æµ‹è¯•çº¯å‡½æ•°
  - æµ‹è¯•æ ¼å¼åŒ–å‡½æ•°
  - æµ‹è¯•è¾…åŠ©å·¥å…·å‡½æ•°
```
```

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ç°æœ‰é¡¹ç›®è¿ç§»æ­¥éª¤

**monSQLize é¡¹ç›®ç¤ºä¾‹**:

```bash
# 1. åˆ›å»ºå­ç›®å½•
mkdir -p test/unit/features
mkdir -p test/unit/infrastructure
mkdir -p test/unit/utils

# 2. ç§»åŠ¨åŠŸèƒ½æ€§æµ‹è¯•
mv test/unit/find.test.js test/unit/features/
mv test/unit/count.test.js test/unit/features/
mv test/unit/aggregate.test.js test/unit/features/
mv test/unit/findPage.test.js test/unit/features/
mv test/unit/findOne.test.js test/unit/features/
mv test/unit/distinct.test.js test/unit/features/

# 3. ç§»åŠ¨åŸºç¡€è®¾æ–½æµ‹è¯•
mv test/unit/logger.test.js test/unit/infrastructure/
mv test/unit/errors.test.js test/unit/infrastructure/
mv test/unit/connection.test.js test/unit/infrastructure/
mv test/unit/connection-simple.test.js test/unit/infrastructure/

# 4. æ›´æ–°æµ‹è¯•é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
# æ›´æ–° package.json ä¸­çš„æµ‹è¯•è·¯å¾„ï¼ˆå¦‚æœæœ‰ç‰¹å®šé…ç½®ï¼‰

# 5. éªŒè¯æµ‹è¯•
npm test
```

**è¿ç§»å‰åå¯¹æ¯”**:

è¿ç§»å‰ï¼ˆæ‰å¹³ç»“æ„ï¼‰:
```
test/unit/
  â”œâ”€ find.test.js             # åŠŸèƒ½
  â”œâ”€ logger.test.js           # åŸºç¡€è®¾æ–½ âŒ æ··åœ¨ä¸€èµ·
  â”œâ”€ errors.test.js           # åŸºç¡€è®¾æ–½ âŒ
  â””â”€ connection.test.js       # åŸºç¡€è®¾æ–½ âŒ
```

è¿ç§»åï¼ˆåˆ†å±‚ç»“æ„ï¼‰:
```
test/unit/
  â”œâ”€ features/                # åŠŸèƒ½æ€§æµ‹è¯• âœ… æ¸…æ™°åˆ†ç±»
  â”‚  â””â”€ find.test.js
  â””â”€ infrastructure/          # åŸºç¡€è®¾æ–½æµ‹è¯• âœ…
     â”œâ”€ logger.test.js
     â”œâ”€ errors.test.js
     â””â”€ connection.test.js
```

---

## ğŸ“Š å½±å“èŒƒå›´

### å—å½±å“çš„é¡¹ç›®

**éœ€è¦è¿ç§»**:
- monSQLize: 10ä¸ªæµ‹è¯•æ–‡ä»¶éœ€è¦é‡æ–°ç»„ç»‡
- å…¶ä»–é¡¹ç›®: æŒ‰å®é™…æƒ…å†µè¯„ä¼°

### å·¥ä½œé‡è¯„ä¼°

| é¡¹ç›® | æµ‹è¯•æ–‡ä»¶æ•° | è¿ç§»éš¾åº¦ | ä¼°è®¡æ—¶é—´ |
|------|-----------|---------|---------|
| monSQLize | 10ä¸ª | ä½ | 10åˆ†é’Ÿ |
| å…¶ä»–é¡¹ç›® | å¾…è¯„ä¼° | ä½ | 5-15åˆ†é’Ÿ |

### å…¼å®¹æ€§

**æµ‹è¯•è¿è¡Œå™¨**:
- âœ… Vitest/Jest: è‡ªåŠ¨é€’å½’æ‰«æå­ç›®å½•ï¼Œæ— éœ€é…ç½®
- âœ… Mocha: æ”¯æŒå­ç›®å½•ï¼Œæ— éœ€é¢å¤–é…ç½®
- âœ… å…¶ä»–æ¡†æ¶: é€šå¸¸æ”¯æŒå­ç›®å½•

**CI/CD**:
- âœ… æ— å½±å“ï¼Œæµ‹è¯•å‘½ä»¤ä¸å˜ï¼ˆnpm testï¼‰
- âœ… è¦†ç›–ç‡æŠ¥å‘Šæ­£å¸¸å·¥ä½œ

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¿æŒåˆ†ç±»ç®€å•æ¸…æ™°

```yaml
æ¨èåˆ†ç±»:
  - features/         # åŠŸèƒ½æ€§æµ‹è¯•
  - infrastructure/   # åŸºç¡€è®¾æ–½æµ‹è¯•
  - utils/            # å·¥å…·å‡½æ•°æµ‹è¯•

ä¸æ¨è:
  - è¿‡åº¦ç»†åˆ†ï¼ˆ>5ä¸ªå­ç›®å½•ï¼‰
  - æ¨¡ç³Šçš„åˆ†ç±»è¾¹ç•Œ
```

### 2. å‘½åä¿æŒä¸€è‡´

```yaml
åŠŸèƒ½æ€§æµ‹è¯•:
  - find.test.js
  - count.test.js
  - aggregate.test.js

åŸºç¡€è®¾æ–½æµ‹è¯•:
  - logger.test.js        # è€Œé logging.test.js
  - errors.test.js        # è€Œé error-codes.test.js
  - connection.test.js    # è€Œé db-connection.test.js
```

### 3. æ–‡æ¡£è¯´æ˜

åœ¨ test/README.md ä¸­è¯´æ˜ç›®å½•ç»“æ„ï¼š

```markdown
# æµ‹è¯•ç›®å½•ç»“æ„

## å•å…ƒæµ‹è¯• (test/unit/)

### features/
åŠŸèƒ½æ€§æµ‹è¯•ï¼Œæµ‹è¯•å¯¹å¤–æš´éœ²çš„ API å’Œä¸šåŠ¡åŠŸèƒ½ã€‚

### infrastructure/
åŸºç¡€è®¾æ–½æµ‹è¯•ï¼Œæµ‹è¯•åº•å±‚æ”¯æ’‘ç³»ç»Ÿï¼ˆæ—¥å¿—ã€é”™è¯¯ã€è¿æ¥ã€ç¼“å­˜ç­‰ï¼‰ã€‚

### utils/
å·¥å…·å‡½æ•°æµ‹è¯•ï¼Œæµ‹è¯•çº¯å‡½æ•°å’Œè¾…åŠ©å·¥å…·ã€‚

## é›†æˆæµ‹è¯• (test/integration/)
æµ‹è¯•è·¨æ¨¡å—äº¤äº’å’Œå®Œæ•´ä¸šåŠ¡æµç¨‹ã€‚

## E2E æµ‹è¯• (test/e2e/)
æµ‹è¯•å®Œæ•´ç”¨æˆ·æµç¨‹ï¼ˆå¯é€‰ï¼‰ã€‚
```

---

## âœ… æ¨èæ–¹æ¡ˆæ€»ç»“

**é‡‡ç”¨æ–¹æ¡ˆ A**ï¼šæŒ‰æµ‹è¯•ç±»å‹åˆ†å­ç›®å½•

**ç›®å½•ç»“æ„**:
```
test/unit/
  â”œâ”€ features/           # åŠŸèƒ½æ€§æµ‹è¯•
  â”œâ”€ infrastructure/     # åŸºç¡€è®¾æ–½æµ‹è¯•
  â””â”€ utils/              # å·¥å…·å‡½æ•°æµ‹è¯•
```

**ä¼˜åŠ¿**:
- âœ… æ¸…æ™°åˆ†ç±»ï¼ŒèŒè´£æ˜ç¡®
- âœ… æ˜“äºæŸ¥æ‰¾å’Œç»´æŠ¤
- âœ… ç¬¦åˆè½¯ä»¶åˆ†å±‚æ€æƒ³
- âœ… ä¾¿äºå•ç‹¬è¿è¡ŒæŸç±»æµ‹è¯•

**å®æ–½å»ºè®®**:
- ğŸ”´ æ–°é¡¹ç›®ï¼šç«‹å³é‡‡ç”¨
- ğŸŸ¡ ç°æœ‰é¡¹ç›®ï¼šé€æ­¥è¿ç§»ï¼ˆä½æˆæœ¬ï¼Œ10åˆ†é’Ÿï¼‰

---

**åˆ†æå®Œæˆæ—¥æœŸ**: 2025-11-04  
**åˆ†æå¸ˆ**: AI Assistant  
**çŠ¶æ€**: âœ… åˆ†æå®Œæˆï¼Œå¾…å®æ–½

