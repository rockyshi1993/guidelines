# 规范变更历史

> 本文档记录 AI 执行规范本身的变更历史

---

## [v2.1] - 2025-11-11

### Added
- **场景 0.1**：添加文档任务判断规则
  - 明确触发条件：文档中代码 ≥ 3 行触发场景 0
  - 添加代码行数计算标准
  - 添加错误案例和自我检查清单

- **快速自检清单**：添加任务开始前的检查清单
  - 场景 0 检查（项目识别、Profile 读取、规范确认）
  - MCP 检查（触发判断、配置验证）
  - 测试检查（规范确认、自动分类）
  - 文档任务检查（代码判断）
  - 输出确认（场景 0 输出、实时检查）

### Changed
- **场景 0 STEP 1**：项目名称识别规则
  - 从简单规则改为 4 级优先识别机制
  - 优先级 1：从用户请求中明确识别
  - 优先级 2：从当前工作目录推断
  - 优先级 3：从正在编辑的文件路径推断
  - 优先级 4：询问用户
  - 添加多项目任务处理规则

- **场景 0 STEP 2**：Profile 读取方式
  - 从"必须完整通读"改为"智能提取关键信息"
  - 添加 4 步结构化提取流程
  - 添加关键章节定位规则（按优先级搜索）
  - 添加关键词匹配提取方法
  - 添加提取结果验证标准

- **场景 0 STEP 6**：输出验证格式
  - 添加条件输出逻辑（IF-THEN 结构）
  - Profile 有禁止/强制项 → 完整格式输出
  - 仅使用通用规范 → 简化格式输出
  - 避免"一刀切"的强制完整输出

- **场景 0.5**：实时检查触发时机
  - 明确触发条件：文件创建/修改后立即触发
  - 添加智能输出格式规则
  - 连续创建 ≤ 3 个文件 → 每个独立输出
  - 连续创建 > 3 个文件 → 批量汇总输出

- **MCP 配置强制检查**：明确触发边界
  - 添加 3 类必须触发场景
    * 用户明确要求查询/分析/修改数据
    * 问题诊断需要查看实际数据
    * 数据探索与分析
  - 添加 3 类不触发场景
    * 编写操作数据库的代码（但不执行查询）
    * 讨论数据库设计（纯理论）
    * 文档/注释编写
  - 添加判断规则和 3 个场景示例

- **第 7 章（guidelines/v2.md）**：测试目录结构
  - 添加测试文件自动分类规则
  - 明确功能性测试触发条件（对外 API、业务功能、CRUD 操作）
  - 明确基础设施测试触发条件（底层支撑、跨功能基础设施）
  - 明确工具函数测试触发条件（纯函数、无副作用）
  - 添加边界情况处理规则（优先级、主要职责）
  - 添加 4 个自动分类示例

### Fixed
- 减少"完整通读"的模糊定义导致的 token 浪费
- 减少项目名称识别的不确定性
- 减少测试文件分类的主观判断
- 减少 MCP 触发条件的歧义

### Technical Details
- 修改文件：
  - `d:\Project\.github\copilot-instructions.md` (7 处修改)
  - `d:\Project\guidelines\guidelines\v2.md` (1 处修改)
- 新增文件：
  - `d:\Project\guidelines\SPECIFICATION-CHANGELOG.md` (本文件)
- 修改总行数：约 300+ 行
- Lint 警告：39 个（markdown 链接锚点警告，非阻塞性）

---

## [v2.0] - 2025-11-10

### Added
- 初始版本发布
- 完整的 22 章节规范（guidelines/v2.md）
- 场景触发器（copilot-instructions.md）
- Bug 修复分析模板
- MCP 调度规则

---

## 规范维护说明

### 如何更新本文档
1. 每次修改规范文件后，立即更新本文档
2. 按 [Keep a Changelog](https://keepachangelog.com/) 格式记录
3. 分类使用：Added/Changed/Deprecated/Removed/Fixed/Security

### 版本号规范
- 主版本号（Major）：破坏性变更
- 次版本号（Minor）：新增功能，向后兼容
- 修订号（Patch）：Bug 修复，向后兼容

### 相关文件
- 主规范文档：`guidelines/guidelines/v2.md`
- AI 执行规范：`.github/copilot-instructions.md`
- MCP 调度规则：`guidelines/mcp/v2.md`
- Bug 分析模板：`guidelines/templates/bug-fix-analysis-template.md`
