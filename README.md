# 项目规范文档

> **最新版本**: 
> - **AI执行入口**: [copilot.md v2.1](./assistant/copilot.md) - AI助手快速决策树（2025-10-30）
> - **完整规范**: [v2.0](./guidelines/v2.md) - 20章节详细规范（2025-10-30）

---

## 📋 简介

本规范体系用于在同一仓库内统一管理多个项目（库/服务/CLI；Node/Python/Go/Java/Rust…），以一致流程交付高质量变更。

### 核心理念

- **集中式配置**: 通过 `guidelines/profiles/<project>.md` 声明项目特定配置
- **AI 友好**: 优先级体系、场景触发器、决策矩阵，便于 AI 助手执行
- **质量保障**: 四要素流程（代码-测试-示例-文档）确保交付完整性
- **多语言支持**: Node.js, Python, Go, Java, Rust 等技术栈

---

## 📚 文档目录

### 核心规范文档

| 文档 | 说明 | 受众 | 状态 |
|------|------|------|------|
| [AI 执行入口 v2.1](./assistant/copilot.md) | AI 助手必读，快速决策树和检查清单 | AI 助手 | ✅ 当前 |
| [v2.0 完整规范](./guidelines/v2.md) | 20章节详细规范，包含场景触发器、决策矩阵 | AI 助手 + 开发者 | ✅ 当前 |
| [MCP 调度规则](./mcp/v2.md) | AI 模型选择与调度规范 | AI 助手 | ✅ 当前 |

### 模板与工具

| 文件 | 说明 |
|------|------|
| [Bug 修复分析模板](./templates/bug-fix-analysis-template.md) | 修复前必填，包含根本原因、影响对比、修复方案 |
| [文件模板](./templates/file-templates.md) | .editorconfig, .gitattributes, README, CHANGELOG 等 |
| [自动化脚本](./templates/automation-scripts.md) | PowerShell 自检脚本、GitHub Actions 配置 |

### 项目配置

| 目录 | 说明 |
|------|------|
| [profiles/](./profiles/) | 各项目的特定配置（覆盖全局规范） |
| [examples/](./examples/) | Bug 分析示例等参考文档 |

---

## 🚀 快速导航

### 给 AI 助手

**⚡ 一键直达规范**:

| 场景 | 直达链接 | 核心规则 | 优先级 |
|------|---------|---------|--------|
| 新增功能 | [→ 四要素流程](./guidelines/v2.md#31-功能添加完整流程四要素代码-测试-示例-文档) | 代码+测试+示例+文档 | 🔴 强制 |
| Bug修复 | [→ Bug模板](./templates/bug-fix-analysis-template.md) | 根本原因+影响对比+修复方案 | 🔴 强制 |
| 大规模编辑 | [→ 脚本策略](./guidelines/v2.md#20-大规模文件编辑策略ai-辅助开发) | 备份+PowerShell+UTF8 | 🔴 强制 |
| 代码审查 | [→ 安全检查](./guidelines/v2.md#9-错误处理与输入校验) | 日志脱敏+输入校验 | 🔴 强制 |
| 文档更新 | [→ 决策矩阵](./guidelines/v2.md#6-代码修改与文档联动) | API变更强制更新 | 🔴 强制 |

**按操作类型快速查询**:

| 操作 | 测试 | 示例 | CHANGELOG | README | 类型声明 |
|------|------|------|-----------|--------|---------|
| 新增功能 | 🔴 强制 | 🔴 强制 | 🔴 强制 | 🟠 必须 | 🟡 推荐 |
| 修改功能 | 🔴 强制 | 🔴 强制 | 🔴 强制 | 🟠 必须 | 🟡 推荐 |
| Bug修复 | 🟠 必须 | 🟢 可选 | 🔴 强制 | 🟡 推荐 | 🟢 可选 |
| 内部重构 | 🟠 必须 | 🟢 可选 | 🟡 推荐 | 🟢 可选 | 🟢 可选 |

**快速执行检查清单**:
```yaml
功能新增/修改:
  [ ] 代码实现 (遵循基线风格)
  [ ] 测试用例 (正常+异常+边界)
  [ ] 示例代码 (可运行+注释)
  [ ] CHANGELOG [Unreleased]
  [ ] README (如API变更)
  [ ] npm test 通过
  [ ] 示例验证通过
  [ ] 无敏感信息泄露
```

**📊 优先级标识**:
- 🔴 **强制** - 不执行则失败
- 🟠 **必须** - 应执行，除非例外
- 🟡 **推荐** - 最佳实践
- 🟢 **可选** - 根据情况判断

**🔍 关键决策点**:
1. **是否修改代码** → 检查测试+示例+文档
2. **是否改API** → 强制更新CHANGELOG+README
3. **编辑行数>100** → 使用脚本而非工具
4. **包含日志** → 检查敏感信息清洗

---

## 🗺️ 我想做...应该读哪里？

> **交互式索引**: 根据你的任务快速定位规范章节

### 🛠️ 开发任务

| 我想... | 直达章节 | 关键要点 |
|---------|---------|---------|
| **新增一个功能** | [→ 四要素流程](./guidelines/v2.md#31-功能添加完整流程四要素代码-测试-示例-文档) | 代码+测试+示例+文档，全部必须 |
| **修改现有功能** | [→ 文档联动](./guidelines/v2.md#6-代码修改与文档联动) | 判断是否需要更新README/CHANGELOG |
| **修复一个Bug** | [→ Bug模板](./templates/bug-fix-analysis-template.md) | 必须填写根本原因、影响对比、修复方案 |
| **优化性能** | [→ 测试覆盖](./guidelines/v2.md#7-测试与质量) | 必须有前后对比测试 |
| **重构代码** | [→ 重构规范](./guidelines/v2.md#31-功能添加完整流程四要素代码-测试-示例-文档) | 保证行为不变，测试覆盖 |

### 📝 文档任务

| 我想... | 直达章节 | 关键要点 |
|---------|---------|---------|
| **更新README** | [→ README规范](./guidelines/v2.md#5-文档与版本策略含自动创建与示例条款) | 功能简介+API+示例引用+注意事项 |
| **记录变更** | [→ CHANGELOG规范](./guidelines/v2.md#5-文档与版本策略含自动创建与示例条款) | 使用[Unreleased]，分类记录 |
| **编写示例** | [→ 示例规范](./guidelines/v2.md#18-功能示例目录examples) | 可运行+详细注释+占位配置 |
| **弃用API** | [→ 弃用流程](./guidelines/v2.md#13-api-稳定性与弃用deprecation) | CHANGELOG标注+迁移建议+保留周期 |

### 🔍 代码审查

| 我想... | 直达章节 | 关键要点 |
|---------|---------|---------|
| **审查日志输出** | [→ 日志安全](./guidelines/v2.md#10-日志分级与敏感信息清洗含可观测性增强) | 无密码/token/连接串，使用查询形状 |
| **审查输入校验** | [→ 校验规范](./guidelines/v2.md#9-错误处理与输入校验) | 类型+必填+范围，可行动错误信息 |
| **审查测试覆盖** | [→ 测试标准](./guidelines/v2.md#7-测试与质量) | 行≥60%，核心API≥70% |
| **审查PR提交** | [→ PR清单](./guidelines/v2.md#16-pr-合并门禁清单) | 11项检查清单 |

### 🚀 工具操作

| 我想... | 直达章节 | 关键要点 |
|---------|---------|---------|
| **大规模编辑文件** | [→ 脚本策略](./guidelines/v2.md#20-大规模文件编辑策略ai-辅助开发) | >100行用PowerShell，备份+UTF8 |
| **配置项目Profile** | [→ Profile模板](./guidelines/v2.md#17-项目-profile-最小模板位于-guidelinesprofilesprojectmd) | 运行命令+覆盖规则+例外声明 |

---

### 给开发者

**按主题查找**:
- [编码风格](./guidelines/v2.md#1-基线风格与语言) - 缩进、换行、编码规范
- [提交规范](./guidelines/v2.md#3-提交与-pr-规范) - Conventional Commits、PR 模板
- [测试覆盖](./guidelines/v2.md#7-测试与质量) - 覆盖率标准、测试框架
- [日志规范](./guidelines/v2.md#10-日志分级与敏感信息清洗含可观测性增强) - 分级、脱敏、结构化
- [API弃用](./guidelines/v2.md#13-api-稳定性与弃用deprecation) - 弃用流程、版本策略
- [PR检查清单](./guidelines/v2.md#16-pr-合并门禁清单) - 合并前必查项

**功能开发流程**:
1. [功能添加完整流程](./guidelines/v2.md#31-功能添加完整流程四要素代码-测试-示例-文档) - 四要素（代码-测试-示例-文档）
2. [文档联动规则](./guidelines/v2.md#6-代码修改与文档联动) - 何时更新文档
3. [示例代码规范](./guidelines/v2.md#18-功能示例目录examples) - examples/ 目录要求

---

## 📊 版本历史

### v2.1 (copilot.md) / v2.0 (v2.md) - 2025-10-30

**版本说明**:
- **assistant/copilot.md v2.1**: AI执行入口的优化版本，提供快速决策树
- **guidelines/v2.md v2.0**: 完整规范的AI友好化版本

**核心改进**:
- ✅ 新增优先级体系：🔴强制 > 🟠必须 > 🟡推荐 > 🟢可选
- ✅ 新增场景触发器：5个IF-THEN规则（功能/Bug/编辑/审查/文档）
- ✅ 新增决策矩阵：6×7表格覆盖所有操作类型
- ✅ 新增执行检查清单：5阶段YAML格式清单
- ✅ 新增快速查询表：关键词+文件类型双维度
- ✅ 新增错误恢复策略：3种失败场景的恢复步骤
- ✅ 优化章节结构：20个章节编号连续完整

**影响范围**:
- 所有AI助手（GitHub Copilot、Claude等）
- 所有使用规范的开发流程

**迁移说明**:
- 新项目请使用 v2.0 规范
- 现有项目建议逐步迁移

### v1.0 (2025-01-20) - 初始版本

**核心内容**:
- 基线风格与语言规范
- Profile选择策略
- 提交与PR规范
- 文档与版本策略
- 测试与质量标准
- 多语言技术栈支持

---

## 📞 支持与反馈

如有问题或建议，请：
1. 提交 Issue 到项目仓库
2. 或联系项目维护者

**维护者**: 项目团队  
**最后更新**: 2025年10月30日