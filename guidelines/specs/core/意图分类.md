# v3 意图分类

> **文件**: specs/core/意图分类.md  
> **版本**: v3.0  
> **日期**: 2025-11-20  
> **说明**: 18种意图分类及输出规范

---

## 📑 目录导航

> 🔴 = 高风险(P0) | 🟡 = 中等风险(P1) | 🟢 = 低风险(P2)

- [意图分类矩阵（18种）](#-意图分类矩阵18种) 🔴 - 快速查找意图和风险等级
- [归入现有意图的操作](#-归入现有意图的操作) 🟡 - 回滚/合并/拆分/升级归类
- [各意图详细说明](#-各意图详细说明) 🔴 - 每种意图的完整规范
  - [Intent-01: 修复Bug](#intent-01-修复bug) 🔴 - 可能删除代码，需P0确认
  - [Intent-02: 开发新功能](#intent-02-开发新功能) 🟡 - 新增代码，中等风险
  - [Intent-03: 代码审查](#intent-03-代码审查) 🟢 - 仅分析，低风险
  - [Intent-04: 生成文档](#intent-04-生成文档) 🟢 - 仅文档，低风险
  - [Intent-05: 系统分析](#intent-05-系统分析) 🟢 - 仅分析，低风险
  - [Intent-06: 生成测试](#intent-06-生成测试) 🟡 - 新增测试，中等风险
  - [Intent-07: 接口测试](#intent-07-接口测试) 🟡 - API测试，中等风险
  - [Intent-08: 重构代码](#intent-08-重构代码) 🔴 - 大规模改动，高风险
  - [Intent-09: 配置修改](#intent-09-配置修改) 🟡 - 影响运行环境，中等风险
  - [Intent-10: 性能优化](#intent-10-性能优化) 🟡 - 修改逻辑，中等风险
  - [Intent-11: 安全检查](#intent-11-安全检查) 🔴 - 敏感信息，高风险
  - [Intent-12: 依赖更新](#intent-12-依赖更新) 🟡 - 版本变更，中等风险
  - [Intent-13: 脚本生成](#intent-13-脚本生成) 🟢 - 工具脚本，低风险
  - [Intent-14: 数据迁移](#intent-14-数据迁移) 🔴 - 数据库变更，高风险
  - [Intent-15: 部署操作](#intent-15-部署操作) 🔴 - 生产环境，高风险
  - [Intent-16: 日志分析](#intent-16-日志分析) 🟢 - 仅分析，低风险
  - [Intent-17: API文档生成](#intent-17-api文档生成) 🟢 - 仅文档，低风险
  - [Intent-18: 数据库查询](#intent-18-数据库查询) 🟢 - 仅查询，低风险

---

## 📚 相关规范文件

**意图识别时使用**:
- 📦 [流程.md](./流程.md) 🔴 - STEP 1使用本文件识别意图
- 📦 [目录结构.md](./目录结构.md) 🔴 - 各意图的输出位置规范

**各意图涉及的规范**:
- 📐 [代码规范.md](../rules/代码规范.md) 🔴 - Intent-01/02/08/10需要
- 📐 [测试规范.md](../rules/测试规范.md) 🔴 - Intent-06/07需要
- 📐 [安全规范.md](../rules/安全规范.md) 🔴 - Intent-11必须，其他建议使用
- 📐 [文档规范.md](../rules/文档规范.md) 🟡 - Intent-04/17需要
- 📐 [API规范.md](../rules/API规范.md) 🟡 - Intent-07/17需要
- 📐 [配置规范.md](../rules/配置规范.md) 🟡 - Intent-09需要
- 📐 [脚本规范.md](../rules/脚本规范.md) 🟡 - Intent-13/14需要
- 📄 [报告模板.md](../output/报告模板.md) 🔴 - 所有意图都需要生成报告

---

## 📋 意图分类矩阵（18种）

| 编号 | 意图类别 | 输出位置 | 风险等级 |
|-----|---------|---------|---------|
| 01 | 修复Bug | `/reports/{模块名}/bugfix/` | P0 |
| 02 | 开发新功能 | `/reports/{模块名}/feature/` | P1 |
| 03 | 代码审查 | `/reports/{模块名}/review/` | P2 |
| 04 | 生成文档 | `/docs/{模块名}/` | P2 |
| 05 | 系统分析 | `/reports/{模块名}/analysis/` | P2 |
| 06 | 生成测试 | `/test/{模块名}-{类型}.test.js` | P1 |
| 07 | 接口测试 | `/test/{模块名}-api.test.js` + 报告 | P1 |
| 08 | 重构代码 | `/reports/{模块名}/refactor/` | P0 |
| 09 | 配置修改 | `/configs/` | P1 |
| 10 | 性能优化 | `/reports/{模块名}/performance/` + `/test/{模块名}-benchmark.test.js` | P1 |
| 11 | 安全检查 | `/reports/{模块名}/security/` | P0 |
| 12 | 依赖更新 | `/reports/{模块名}/dependency/` | P1 |
| 13 | 脚本生成 | `/scripts/{模块名}-*.js` | P2 |
| 14 | 数据迁移 | `/scripts/{模块名}-*.js` | P0 |
| 15 | 部署操作 | `/deploy/` | P0 |
| 16 | 日志分析 | `/reports/{模块名}/logs/` | P2 |
| 17 | API文档 | `/docs/{模块名}/api/` | P2 |
| 18 | 数据库查询 | `/scripts/{模块名}-*.js` | P2 |

---

## 🔄 归入现有意图的操作

以下操作归入现有意图类别，不单独列为新意图：

- **回滚操作** → 归入 **Intent-08 (重构代码)**
- **代码合并** → 归入 **Intent-08 (重构代码)**
- **模块拆分** → 归入 **Intent-08 (重构代码)**
- **版本升级** → 归入 **Intent-12 (依赖更新)**

---

## 📝 各意图详细说明

### Intent-01: 修复Bug

**输出位置**: `/reports/{模块名}/bugfix/`

**执行流程**:
1. 分析Bug根本原因
2. 生成Bug分析报告 → `/reports/{模块名}/bugfix/bug-{id}-analysis.md`
3. 修复代码 → 项目src
4. 编写测试用例 → `/test/{模块名}-unit.test.js`
5. 运行测试验证
6. 更新文档 → `/docs/{模块名}/`
7. 生成修复报告 → `/reports/{模块名}/bugfix/bug-{id}-fix.md`

**风险等级**: P0（高风险，需要P0确认）

**涉及规范**:
- 代码规范
- 测试规范
- 文档规范
- 项目规范

---

### Intent-02: 开发新功能

**输出位置**: `/reports/{模块名}/feature/`

**执行流程**:
1. 生成功能设计方案 → `/reports/{模块名}/feature/feature-{name}-design.md`
2. 用户确认设计方案
3. 开发代码 → 项目src
4. 编写测试用例 → `/test/{模块名}-*.test.js`
5. 运行测试验证
6. 生成API文档 → `/docs/{模块名}/api/`
7. 生成Swagger → `/docs/{模块名}/api/openapi.yaml`
8. 生成功能报告 → `/reports/{模块名}/feature/feature-{name}-report.md`

**风险等级**: P1（中等风险）

**涉及规范**:
- 代码规范
- 测试规范
- 文档规范
- API规范
- 项目规范

---

### Intent-03: 代码审查

**输出位置**: `/reports/{模块名}/review/`

**执行流程**:
1. 分析代码质量
2. 检查代码规范
3. 识别潜在问题
4. 生成审查报告 → `/reports/{模块名}/review/review-{timestamp}.md`
5. 提供改进建议

**风险等级**: P2（低风险）

**涉及规范**:
- 代码规范
- 安全规范
- 性能规范

---

### Intent-04: 生成文档

**输出位置**: `/docs/{模块名}/`

**执行流程**:
1. 分析代码结构
2. 生成模块文档 → `/docs/{模块名}/README.md`
3. 生成API文档 → `/docs/{模块名}/api/endpoints.md`
4. 生成Swagger → `/docs/{模块名}/api/openapi.yaml`
5. 生成使用示例 → `/docs/{模块名}/examples/`

**风险等级**: P2（低风险）

**涉及规范**:
- 文档规范
- API规范

---

### Intent-05: 系统分析

**输出位置**: `/reports/{模块名}/analysis/`

**执行流程**:
1. 分析系统架构
2. 识别依赖关系
3. 评估技术债务
4. 生成分析报告 → `/reports/{模块名}/analysis/system-analysis-{timestamp}.md`
5. 提供优化建议

**风险等级**: P2（低风险）

**涉及规范**:
- 通用规范

---

### Intent-06: 生成测试

**输出位置**: `/test/{模块名}-{类型}.test.js`

**执行流程**:
1. 分析代码覆盖率
2. 识别缺失的测试场景
3. 生成单元测试 → `/test/{模块名}-unit.test.js`
4. 生成集成测试 → `/test/{模块名}-integration.test.js`
5. 生成E2E测试 → `/test/{模块名}-e2e.test.js`（可选）
6. 运行测试验证
7. 生成测试报告 → `/reports/{模块名}/test-report.md`

**风险等级**: P1（中等风险）

**涉及规范**:
- 测试规范
- 代码规范

---

### Intent-07: 接口测试

**输出位置**: `/test/{模块名}-api.test.js` + 报告

**执行流程**:
1. 识别API接口
2. 生成API测试用例 → `/test/{模块名}-api.test.js`
3. 运行API测试
4. 生成测试报告 → `/reports/{模块名}/api-test/api-test-{timestamp}.md`

**风险等级**: P1（中等风险）

**涉及规范**:
- 测试规范
- API规范

---

### Intent-08: 重构代码

**输出位置**: `/reports/{模块名}/refactor/`

**执行流程**:
1. 生成重构方案 → `/reports/{模块名}/refactor/refactor-plan-{timestamp}.md`
2. 用户确认方案
3. 执行重构 → 项目src
4. 编写/更新测试 → `/test/{模块名}-*.test.js`
5. 运行测试验证
6. 更新文档 → `/docs/{模块名}/`
7. 生成重构报告 → `/reports/{模块名}/refactor/refactor-result-{timestamp}.md`

**风险等级**: P0（高风险，需要P0确认）

**涉及规范**:
- 代码规范
- 测试规范
- 文档规范

**包含操作**:
- 回滚操作
- 代码合并
- 模块拆分

---

### Intent-09: 配置修改

**输出位置**: `/configs/`

**执行流程**:
1. 分析配置需求
2. 生成配置方案 → `/reports/{模块名}/config-plan-{timestamp}.md`
3. 用户确认方案
4. 修改配置文件 → `/configs/config.{env}.json`
5. 验证配置正确性
6. 生成配置报告 → `/reports/{模块名}/config-result-{timestamp}.md`

**风险等级**: P1（中等风险）

**涉及规范**:
- 配置规范
- 安全规范

---

### Intent-10: 性能优化

**输出位置**: `/reports/{模块名}/performance/` + 基准测试

**执行流程**:
1. 建立性能基线 → `/test/{模块名}-benchmark.test.js`
2. 记录当前性能指标
3. 生成优化方案 → `/reports/{模块名}/performance/optimization-plan-{timestamp}.md`
4. 用户确认方案
5. 优化代码 → 项目src
6. 运行基准测试
7. 对比性能差异
8. 生成性能报告 → `/reports/{模块名}/performance/performance-result-{timestamp}.md`

**风险等级**: P1（中等风险）

**涉及规范**:
- 代码规范
- 性能规范
- 测试规范

---

### Intent-11: 安全检查

**输出位置**: `/reports/{模块名}/security/`

**执行流程**:
1. 扫描代码安全问题
2. 检查依赖漏洞
3. 识别敏感信息泄露
4. 生成安全报告 → `/reports/{模块名}/security/security-scan-{timestamp}.md`
5. 提供修复建议

**风险等级**: P0（高风险）

**涉及规范**:
- 安全规范
- 代码规范

---

### Intent-12: 依赖更新

**输出位置**: `/reports/{模块名}/dependency/`

**执行流程**:
1. 分析当前依赖
2. 识别可更新的依赖
3. 评估更新风险
4. 生成更新方案 → `/reports/{模块名}/dependency/update-plan-{timestamp}.md`
5. 用户确认方案
6. 更新依赖 → package.json/requirements.txt等
7. 运行测试验证
8. 生成更新报告 → `/reports/{模块名}/dependency/update-result-{timestamp}.md`

**风险等级**: P1（中等风险）

**涉及规范**:
- 依赖规范
- 测试规范

**包含操作**:
- 版本升级

---

### Intent-13: 脚本生成

**输出位置**: `/scripts/{模块名}-*.js`

**执行流程**:
1. 分析脚本需求
2. 生成脚本代码 → `/scripts/{模块名}-{功能}.{ext}`
3. 测试脚本执行
4. 生成脚本文档 → `/docs/{模块名}/scripts.md`（可选）
5. 生成脚本报告 → `/reports/{模块名}/script-{name}.md`（可选）

**风险等级**: P2（低风险）

**涉及规范**:
- 脚本规范
- 代码规范

**脚本语言**:
- 遵从 Profile 指定
- 默认 .js

---

### Intent-14: 数据迁移

**输出位置**: `/scripts/{模块名}-*.js`

**执行流程**:
1. 分析数据迁移需求
2. 生成迁移方案 → `/reports/{模块名}/migration/migration-plan-{timestamp}.md`
3. 用户确认方案（⚠️ P0确认）
4. 生成迁移脚本 → `/scripts/{模块名}-migrate-{version}.js`
5. 生成回滚脚本 → `/scripts/{模块名}-rollback-{version}.js`
6. 测试迁移脚本
7. 生成迁移报告 → `/reports/{模块名}/migration/migration-result-{timestamp}.md`

**风险等级**: P0（高风险，需要P0确认）

**涉及规范**:
- 脚本规范
- 数据规范
- 安全规范

---

### Intent-15: 部署操作

**输出位置**: `/deploy/`

**执行流程**:
1. 分析部署需求
2. 生成部署方案 → `/reports/{模块名}/deploy-plan-{timestamp}.md`
3. 用户确认方案（⚠️ P0确认）
4. 生成部署配置 → `/deploy/docker-compose.yml`
5. 生成部署脚本 → `/deploy/scripts/deploy.js`
6. 生成健康检查 → `/deploy/scripts/health-check.js`
7. 生成部署文档 → `/deploy/README.md`
8. 生成部署报告 → `/reports/{模块名}/deploy-result-{timestamp}.md`

**风险等级**: P0（高风险，需要P0确认）

**涉及规范**:
- 部署规范
- 配置规范
- 安全规范

---

### Intent-16: 日志分析

**输出位置**: `/reports/{模块名}/logs/`

**执行流程**:
1. 收集日志数据
2. 分析日志模式
3. 识别异常和问题
4. 生成分析报告 → `/reports/{模块名}/logs/log-analysis-{timestamp}.md`
5. 提供优化建议

**风险等级**: P2（低风险）

**涉及规范**:
- 通用规范

---

### Intent-17: API文档生成

**输出位置**: `/docs/{模块名}/api/`

**执行流程**:
1. 分析API接口
2. 生成接口文档 → `/docs/{模块名}/api/endpoints.md`
3. 生成Swagger文档 → `/docs/{模块名}/api/openapi.yaml`
4. 生成请求示例 → `/docs/{模块名}/examples/`
5. 生成响应示例 → `/docs/{模块名}/examples/`

**风险等级**: P2（低风险）

**涉及规范**:
- API规范
- 文档规范

---

### Intent-18: 数据库查询

**输出位置**: `/scripts/{模块名}-*.js`

**执行流程**:
1. 分析查询需求
2. 生成查询脚本 → `/scripts/{模块名}-query-{name}.js`
3. 测试查询执行
4. 生成查询结果 → `/reports/{模块名}/queries/query-result-{timestamp}.md`（可选）

**风险等级**: P2（低风险）

**涉及规范**:
- 脚本规范
- 数据规范

---

## 🎯 风险等级定义

### P0 - 高风险（必须P0确认）

**定义**: 可能导致数据丢失、系统中断、生产故障的操作

**包含意图**:
- Intent-01: 修复Bug（可能影响现有功能）
- Intent-08: 重构代码（大规模代码改动）
- Intent-11: 安全检查（发现高危问题需修复）
- Intent-14: 数据迁移（数据库变更）
- Intent-15: 部署操作（影响生产环境）

**确认要求**:
- 必须在 STEP 7 获得用户正面确认
- 展示详细的风险说明
- 用户必须明确回复："我已理解以上 P0 风险操作，明确同意执行"

---

### P1 - 中等风险

**定义**: 可能影响系统功能、性能，但不会导致严重故障

**包含意图**:
- Intent-02: 开发新功能
- Intent-06: 生成测试
- Intent-07: 接口测试
- Intent-09: 配置修改
- Intent-10: 性能优化
- Intent-12: 依赖更新

**确认要求**:
- 在 STEP 7 展示执行计划
- 用户确认即可继续

---

### P2 - 低风险

**定义**: 不影响系统运行，仅生成报告或文档

**包含意图**:
- Intent-03: 代码审查
- Intent-04: 生成文档
- Intent-05: 系统分析
- Intent-13: 脚本生成
- Intent-16: 日志分析
- Intent-17: API文档生成
- Intent-18: 数据库查询

**确认要求**:
- 在 STEP 7 展示执行计划
- 用户确认即可继续

---

## 📊 意图与STEP的对应关系

所有意图都遵循相同的 23 个 STEP 流程：

```
STEP 0-7: 分析和确认（所有意图相同）
STEP 8: 固定执行流程（所有意图相同）
STEP 9-16: 执行和确认（根据意图类型有所不同）
STEP 17-22: 质量验证和提交（所有意图相同）
```

**差异主要在 STEP 9-16**:
- 代码类意图: 开发代码 → 测试 → 文档
- 文档类意图: 生成文档
- 脚本类意图: 生成脚本 → 测试
- 分析类意图: 分析 → 生成报告

---

**文件创建**: 2025-11-20  
**最后更新**: 2025-11-20  
**状态**: ✅ 完整

