# v3 目录结构规范

> **文件**: specs/core/目录结构.md  
> **版本**: v3.0  
> **日期**: 2025-11-20  
> **说明**: AI 生成的目录结构规范

---

## 📑 目录导航

> 🔴 = 必须遵守 | 🟡 = 建议遵守 | 🟢 = 参考

- [目录分类原则](#-目录分类原则) 🔴 - 7个目录的分类规则
  - [按模块聚合的目录（3个）](#按模块聚合的目录3个) 🔴 - reports/plans/docs按模块分
  - [不按模块分的目录（4个）](#不按模块分的目录4个) 🔴 - test/scripts/configs/deploy不分模块
- [完整目录结构](#️-完整目录结构) 🔴 - 标准目录树结构
- [文件命名规范](#-文件命名规范) 🔴 - 各类文件的命名格式
  - [报告文件命名](#报告文件命名) 🔴 - analysis-plan-{timestamp}.md
  - [方案文件命名](#方案文件命名) 🔴 - implementation-plan-{timestamp}.md
  - [测试文件命名](#测试文件命名) 🔴 - {模块名}-{类型}.test.js
  - [脚本文件命名](#脚本文件命名) 🔴 - {模块名}-{功能}.js
  - [配置文件命名](#配置文件命名) 🟡 - 环境相关配置
  - [部署文件命名](#部署文件命名) 🟡 - 部署脚本和配置
  - [文档文件命名](#文档文件命名) 🔴 - README/IMPLEMENTATION/STATUS/CHANGELOG
- [临时文件管理](#-临时文件管理) 🔴 - .temp目录的使用和清理
- [Profile 冲突解决](#-profile-冲突解决) 🔴 - 项目规范优先原则

---

## 📚 相关规范文件

**目录结构使用场景**:
- 📦 [流程.md](./流程.md) 🔴 - STEP 6/20使用，确定文件存放位置
- 📦 [意图分类.md](./意图分类.md) 🔴 - 各意图的默认输出位置
- 📄 [报告模板.md](../output/报告模板.md) 🔴 - 报告文件存放在reports/

**各目录涉及的规范**:
- 📐 [测试规范.md](../rules/测试规范.md) 🔴 - test/目录文件规范
- 📐 [脚本规范.md](../rules/脚本规范.md) 🔴 - scripts/目录文件规范
- 📐 [配置规范.md](../rules/配置规范.md) 🔴 - configs/目录文件规范
- 📐 [文档规范.md](../rules/文档规范.md) 🔴 - docs/目录文件规范

**Profile优先**:
- 🔴 如果 `guidelines/profiles/{project}.md` 定义了不同的目录结构，优先使用项目规范

---

## 📂 目录分类原则

### 按模块聚合的目录（3个）

这些目录需要按模块创建子目录：

1. **reports/{模块名}/** - 报告目录
2. **plans/{模块名}/** - 方案目录
3. **docs/{模块名}/** - 文档目录

### 不按模块分的目录（4个）

这些目录不按模块分，文件名包含模块标识：

4. **test/** - 测试目录
5. **scripts/** - 脚本目录
6. **configs/** - 配置目录
7. **deploy/** - 部署目录

---

## 🗂️ 完整目录结构

```
项目根目录/
│
├── STATUS.md                   # 项目整体状态（AI自动生成）
├── CHANGELOG.md                # 整体变更概览（AI自动汇总）
├── README.md                   # 项目说明（不含Git教程）
│
├── reports/{模块名}/           # 1️⃣ 报告目录（AI生成，按模块聚合）
│   ├── .temp/                  # 临时方案（需求分析阶段）
│   │   ├── analysis-part-*.md         # 分段分析文件
│   │   └── analysis-plan-*.md         # 需求分析报告（待确认）
│   ├── final/                  # 最终方案（用户确认后）
│   │   ├── implementation-plan-*.md   # 实现方案
│   │   └── execution-result-*.md      # 执行结果报告
│   ├── bugfix/                 # Bug修复报告
│   ├── feature/                # 功能设计报告
│   ├── review/                 # 代码审查报告
│   ├── analysis/               # 系统分析报告
│   ├── refactor/               # 重构方案报告
│   ├── performance/            # 性能优化报告
│   ├── security/               # 安全检查报告
│   ├── dependency/             # 依赖更新报告
│   ├── migration/              # 数据迁移报告
│   ├── api-test/               # API测试报告
│   ├── logs/                   # 日志分析报告
│   └── queries/                # 查询结果报告
│
├── plans/{模块名}/             # 2️⃣ 方案目录（AI生成，按模块聚合）
│   ├── IMPLEMENTATION.md       # 实现方案（持续同步更新）
│   │   # 从 reports/{模块名}/final/ 同步，并持续维护
│   │   # ⚠️ 必须与实际代码保持同步
│   ├── STATUS.md               # 模块状态（AI自动生成）
│   └── CHANGELOG.md            # 模块详细变更日志（AI自动记录）
│
├── docs/{模块名}/              # 3️⃣ 文档目录（AI生成，按模块聚合）
│   ├── README.md               # 模块说明
│   ├── ARCHITECTURE.md         # 架构文档（可选）
│   ├── api/                    # API文档
│   │   ├── openapi.yaml        # Swagger文档（根据接口自动生成）
│   │   └── endpoints.md        # 接口说明
│   └── examples/               # 示例代码
│       └── *.js/ts
│
├── test/                       # 4️⃣ 测试目录（AI生成，不按模块分）
│   ├── {模块名}-unit.test.js          # 单元测试
│   ├── {模块名}-integration.test.js   # 集成测试
│   ├── {模块名}-e2e.test.js           # E2E测试
│   ├── {模块名}-api.test.js           # API测试
│   └── {模块名}-benchmark.test.js     # 基准测试
│   
│   注意: 检测并适配现有测试目录结构
│         - 如果项目已有 test/ 或 tests/，使用现有结构
│         - 测试文件不分子目录，直接在根目录
│         - 文件名格式: {模块名}-{类型}.test.js
│
├── scripts/                    # 5️⃣ 脚本目录（AI生成，不按模块分）
│   ├── {模块名}-build.js              # 构建脚本
│   ├── {模块名}-migrate.js            # 迁移脚本
│   └── {模块名}-deploy.js             # 部署脚本
│   
│   注意: 脚本语言遵从 Profile 指定
│         - 默认 .js
│         - Profile可指定 .sh/.py/.ts
│         - 文件名格式: {模块名}-{功能}.{ext}
│
├── configs/                    # 6️⃣ 配置目录（AI生成，不按模块分）
│   ├── config.json
│   ├── config.dev.json
│   ├── config.test.json
│   └── config.prod.json
│
└── deploy/                     # 7️⃣ 部署目录（AI生成，不按模块分）
    ├── README.md
    ├── docker-compose.yml
    ├── Dockerfile
    └── scripts/
        ├── deploy.js
        ├── rollback.js
        └── health-check.js
```

---

## 📋 文件命名规范

### 测试文件

**格式**: `{模块名}-{类型}.test.js`

**示例**:
```
test/user-auth-unit.test.js
test/user-auth-integration.test.js
test/order-api.test.js
test/payment-benchmark.test.js
```

**不使用**:
```
❌ test/unit/user-auth.test.js
❌ test/{模块名}/unit/*.test.js
```

### 脚本文件

**格式**: `{模块名}-{功能}.{ext}`

**示例**:
```
scripts/user-auth-build.js
scripts/order-migrate.js
scripts/payment-deploy.sh
```

**不使用**:
```
❌ scripts/general/build-user-auth.js
❌ scripts/{类型}/{模块名}-*.js
```

### 报告文件

**格式**: `{类型}-{timestamp}.md`

**示例**:
```
reports/user-auth/.temp/analysis-plan-20251120-143000.md
reports/user-auth/final/implementation-plan-20251120-150000.md
reports/user-auth/bugfix/bug-fix-001.md
```

---

## 🔄 临时方案与最终方案

### 流程

```
STEP 6: 生成需求分析报告
  → reports/{模块名}/.temp/analysis-plan-{timestamp}.md

STEP 7: 用户确认

STEP 8: 用户确认后，升级为实现方案
  → reports/{模块名}/final/implementation-plan-{timestamp}.md

STEP 15: 同步到方案目录
  → plans/{模块名}/IMPLEMENTATION.md
  ⚠️ 此后必须持续同步更新

代码修改时:
  → 更新 plans/{模块名}/IMPLEMENTATION.md
  → 记录版本变更
  → 说明修改原因
```

### 目录结构

```
/reports/{模块名}/
  ├── .temp/                           # 临时方案（需求分析阶段）
  │   ├── analysis-part-*.md           # 分段分析文件
  │   └── analysis-plan-*.md           # 需求分析报告（待确认）
  └── final/                           # 最终方案（用户确认后）
      ├── implementation-plan-*.md     # 实现方案
      └── execution-result-*.md        # 执行结果报告
```

---

## 🔍 目录检测逻辑

### 测试目录适配

```yaml
IF: Profile 指定测试目录
  使用 Profile 指定的目录

ELSE IF: 项目已有 test/ 目录
  使用 test/ 结构（不按模块分）

ELSE IF: 项目已有 tests/ 目录
  使用 tests/ 结构（不按模块分）

ELSE:
  创建 test/ 结构（推荐单数形式，不按模块分）
```

**示例**:
```
现有项目结构: test/
AI 生成位置: test/user-auth-unit.test.js

现有项目结构: tests/
AI 生成位置: tests/user-auth-unit.test.js

注意: 测试文件不分子目录，文件名包含模块名和类型
```

---

## 📊 路径对比

### ❌ 错误示例（按类型分散）

```
/reports/bugfix/user-auth/
/reports/feature/user-auth/
/reports/review/user-auth/
```

### ✅ 正确示例（reports按模块聚合）

```
/reports/user-auth/
  ├── .temp/
  ├── final/
  ├── bugfix/
  ├── feature/
  └── review/
```

### ✅ 正确示例（plans按模块聚合）

```
/plans/user-auth/
  ├── IMPLEMENTATION.md
  ├── STATUS.md
  └── CHANGELOG.md
```

### ✅ 正确示例（docs按模块聚合）

```
/docs/user-auth/
  ├── README.md
  └── api/
```

### ✅ 正确示例（test不按模块分）

```
/test/
  ├── user-auth-unit.test.js
  ├── user-auth-integration.test.js
  ├── order-unit.test.js
  └── order-api.test.js
```

---

## ⚙️ 特殊说明

### 1. src目录

**AI 不管理 src 目录**
- src 目录由项目自行管理
- AI 只负责 7 个规范目录
- 代码开发时遵循项目已有的 src 结构

### 2. 脚本语言选择

```yaml
优先级:
  1. Profile 指定的语言 (最高优先级)
  2. 项目已有脚本的语言
  3. 默认 .js

示例:
  IF: Profile 指定 shell
    生成: scripts/{模块名}-build.sh
  ELSE IF: 项目已有 .py 脚本
    生成: scripts/{模块名}-build.py
  ELSE:
    生成: scripts/{模块名}-build.js
```

### 3. 配置文件

```yaml
统一管理:
  - 不按模块分
  - 按环境分: dev/test/prod
  - 格式: config.{env}.json

示例:
  configs/config.json         # 默认配置
  configs/config.dev.json     # 开发环境
  configs/config.test.json    # 测试环境
  configs/config.prod.json    # 生产环境
```

### 4. 部署目录

```yaml
统一管理:
  - 不按模块分
  - 包含所有模块的部署配置
  - Docker配置、部署脚本、健康检查等

示例:
  deploy/
    ├── README.md
    ├── docker-compose.yml    # 所有服务
    ├── Dockerfile
    └── scripts/
        ├── deploy.js         # 部署所有模块
        ├── rollback.js       # 回滚
        └── health-check.js   # 健康检查
```

---

## 📝 创建目录的时机

### 自动创建

- reports/{模块名}/ - STEP 6 生成报告时
- plans/{模块名}/ - STEP 15 同步方案时
- docs/{模块名}/ - STEP 15 生成文档时

### 按需创建

- test/ - STEP 11 编写测试时（如不存在）
- scripts/ - 脚本生成意图时
- configs/ - 配置修改意图时
- deploy/ - 部署操作意图时

### 不自动创建

- src/ - 由项目管理，AI 不创建

---

**文件创建**: 2025-11-20  
**最后更新**: 2025-11-20  
**状态**: ✅ 完整

