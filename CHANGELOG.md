# 模型描述与调用规则更新日志

**日期**: 2025-01-28  
**变更类型**: 规范优化

---

## 📋 更新概览

本次更新对 MCP 模型描述和调用规则进行了全面规范化，提升了调度决策的清晰度和一致性。

---

## 🔧 主要变更

### 1. 模型描述重写 (`multi-mcp/mistral/config.json`)

#### 变更原则
- ✅ 统一格式：所有模型补齐 `note` 字段
- ✅ 客观描述：移除"最强"等主观表述，使用"高性能"等客观能力描述
- ✅ 成本标签：明确标注成本/延迟等级（低/中/高）
- ✅ 边界清晰：明确适用场景与限制条件
- ✅ 角色定位：区分官方模型与代理（agent）

#### 具体变更

| 模型 | 旧描述 | 新描述 | 关键改进 |
|------|--------|--------|---------|
| **codestral** | 代码生成和重构专家 | 代码生成与重构专家，专注于代码补全、函数生成、单元测试编写 | ✅ 明确具体能力范围 <br> ✅ 新增成本/延迟标签 <br> ✅ 说明不适用于长篇自然语言推理 |
| **pixtral** | 图像分析和视觉任务 | 多模态视觉理解模型，处理图像分析、OCR、视觉问答任务 | ✅ 强调多模态能力 <br> ✅ 新增格式要求说明 <br> ✅ 明确需要显式图像输入 |
| **magistral** | 通用推理和复杂问题解决 | 通用推理代理，擅长复杂指令分解、多步骤任务编排、工具调用 | ✅ 明确为"代理"而非基础模型 <br> ✅ 突出工具调用编排能力 <br> ✅ 新增适用场景说明 |
| **mistral_large** | 最强推理能力，处理极复杂任务 | 高性能通用推理模型，处理长上下文、高精度、极复杂逻辑任务 | ✅ "最强"→"高性能"（客观化） <br> ✅ 明确长上下文支持 <br> ✅ 强调按需启用（成本考虑） |
| **mistral_small** | 快速响应的轻量级模型 | 轻量快速响应模型，处理简单问答、分类、路由、摘要任务 | ✅ 明确具体任务类型 <br> ✅ 新增"不适用于复杂推理"限制 |
| **devstral** | 开发工具专家，代码审查和技术债务分析 | 开发工具链代理，专注代码审查、技术债识别、测试覆盖率分析 | ✅ 明确为"代理"定位 <br> ✅ 新增"仅做静态分析"限制 <br> ✅ 强调不执行构建/部署 |
| **mixtral** | Mixtral-8x7B: 高性价比... | Mixtral-8x7B 混合专家模型，平衡性能与成本的通用推理处理器 | ✅ 简化描述，突出性价比 <br> ✅ 明确与 large/small 的比较 |

---

### 2. 调用规则优化 (`guidelines/mcp-calling-rules.md`)

#### 新增内容

**A. 模型选型决策矩阵**
- 📊 新增 7 列维度表格：模型名称、核心能力、适用场景、成本/延迟、委派时机
- 🎯 新增 5 条选型决策规则：
  1. 优先本地处理
  2. 成本敏感型选择
  3. 延迟敏感型选择
  4. 精度优先型选择
  5. 专业领域型选择

**B. 流程图更新**
- 🔄 统一术语："能力评估" → "能力评估：本地是否可高质量完成"
- 🔄 增加步骤："结果验证" → "结果验证：正确性、完整性与安全性"
- 🔄 优化描述："结果整合" → "本地补充：结合项目规范与上下文"

---

## 📊 影响分析

### 对开发者的影响
✅ **更清晰的选型指导**：明确成本、延迟、能力边界  
✅ **避免过度调用**：更准确识别本地可处理的任务  
✅ **成本优化**：通过决策矩阵合理选择模型等级

### 对 AI 助手的影响
✅ **统一调度逻辑**：基于标准化的模型描述做决策  
✅ **减少冗余调用**：清晰的适用场景避免试错  
✅ **提升用户体验**：更快响应（优先本地+合理委派）

---

## 🔍 质量保证

### 验证检查项
- ✅ JSON 格式验证通过（config.json）
- ✅ Markdown 语法检查通过（mcp-calling-rules.md）
- ✅ 所有模型 `note` 字段完整
- ✅ 描述术语一致性（代理 vs 模型）
- ✅ 成本/延迟标签完整（低/中/高）

---

## 📝 后续建议

### 短期优化
1. **实测验证**：在实际项目中测试新的选型矩阵效果
2. **成本监控**：记录各模型调用频率与成本，优化决策规则
3. **文档同步**：将模型描述同步到项目 README.md

### 长期优化
1. **动态调度**：基于实时成本/负载动态选择模型
2. **A/B 测试**：对比本地处理 vs 委派的质量差异
3. **用户反馈**：收集用户对响应速度/质量的评价

---

## 📚 相关文件

- `multi-mcp/mistral/config.json` - 模型配置
- `guidelines/mcp-calling-rules.md` - 调用规则
- `.github/copilot-instructions.md` - Copilot 使用说明（引用规则）

---

**变更作者**: GitHub Copilot  
**审核状态**: 待人工审核

---

## 2025-10-28 补充

- 更新 `guidelines/mcp-rule.md`：
  - 明确“默认模型职责范围（强制）”：仅限意图分析、MCP 调用、结果整合与转发
  - 调整选型原则为“适配性优先，兼顾时间与成本”，并给出冲突处理准则
- 同步说明模型选择时的优先级顺序：能力适配度 > 时延/响应时间（SLA） > 成本预算
