# å·¥å…·è°ƒç”¨è§„èŒƒ - å®æ–½å®ŒæˆæŠ¥å‘Š

> **æ—¥æœŸ**: 2025-11-21  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **æ–‡ä»¶**: `guidelines/specs/rules/å·¥å…·è°ƒç”¨è§„èŒƒ.md`

---

## ğŸ“Š å®æ–½æ¦‚è§ˆ

### åˆ›å»ºçš„æ–‡ä»¶

1. **ä¸»è§„èŒƒæ–‡ä»¶**: `guidelines/specs/rules/å·¥å…·è°ƒç”¨è§„èŒƒ.md` (çº¦800è¡Œ)
2. **é›†æˆä½ç½®**: å·²æ›´æ–°åˆ° `guidelines/v3.md` çš„4ä¸ªä½ç½®

### è§„èŒƒæ ¸å¿ƒå†…å®¹

#### 1. å·¥å…·åˆ†ç±» (9å¤§ç±»)

| ç±»åˆ« | å·¥å…·æ•°é‡ | é£é™©çº§åˆ« | ç¡®è®¤è¦æ±‚ |
|------|---------|---------|---------|
| **æ–‡ä»¶æ“ä½œ** | 4ä¸ª | ğŸŸ¡ ä¸­é£é™© | åˆ é™¤éœ€ç¡®è®¤ |
| **ä»£ç åˆ†æ** | 2ä¸ª | ğŸŸ¢ ä½é£é™© | æ— éœ€ç¡®è®¤ |
| **æ‰§è¡Œå·¥å…·** | 1ä¸ª | ğŸ”´ é«˜é£é™© | å±é™©å‘½ä»¤éœ€ç¡®è®¤ |
| **ä¸“ä¸šä»£ç†** | 6ä¸ª | ğŸŸ¡ ä¸­é£é™© | éœ€è®°å½•å®¡è®¡ |
| **æ•°æ®åº“æ“ä½œ** | 20+ä¸ª | ğŸ”´ é«˜é£é™© | å†™å…¥/åˆ é™¤éœ€ç¡®è®¤ |

**æ€»è®¡**: 33+ä¸ªå·¥å…·çš„å®Œæ•´è§„èŒƒ

---

#### 2. 4çº§ç¡®è®¤æœºåˆ¶

```yaml
çº§åˆ«0: æ— éœ€ç¡®è®¤ (ç»¿ç¯) âœ…
  - read_file
  - file_search  
  - grep_search
  - get_errors
  - æ•°æ®åº“æŸ¥è¯¢(åªè¯»)

çº§åˆ«1: è‡ªåŠ¨æ‰§è¡Œï¼Œéœ€è®°å½• (é»„ç¯) âš ï¸
  - create_file (æ–°å»ºä»£ç )
  - insert_edit_into_file (æ–°å¢ä»£ç )
  - run_in_terminal (npm test)

çº§åˆ«2: éœ€è¦æç¤º (æ©™ç¯) âš ï¸
  - run_in_terminal (npm install)
  - ä¿®æ”¹é…ç½®æ–‡ä»¶

çº§åˆ«3: å¿…é¡»ç¡®è®¤ (çº¢ç¯) ğŸ”´
  - åˆ é™¤ä»£ç /æ–‡ä»¶
  - éƒ¨ç½²åˆ°ç”Ÿäº§
  - æ•°æ®åº“åˆ é™¤æ“ä½œ
  - åœ¨STEP 7çš„P0æ¸…å•ä¸­åˆ—å‡º
```

---

#### 3. å·¥å…·è¯¦ç»†è§„èŒƒ

**æ–‡ä»¶æ“ä½œå·¥å…·**:
1. `read_file` - âœ… è‡ªç”±ä½¿ç”¨ï¼Œè¯»å–é¡¹ç›®æ–‡ä»¶
2. `create_file` - âš ï¸ è‡ªåŠ¨æ‰§è¡Œï¼Œåˆ›å»ºæ–°æ–‡ä»¶
3. `insert_edit_into_file` - âš ï¸ éœ€éµå®ˆç¦æ­¢åˆ é™¤ä¿æŠ¤
4. `file_search` - âœ… è‡ªç”±ä½¿ç”¨ï¼Œæœç´¢æ–‡ä»¶

**ä»£ç åˆ†æå·¥å…·**:
5. `grep_search` - âœ… è‡ªç”±ä½¿ç”¨ï¼Œä»£ç æœç´¢
6. `get_errors` - âœ… è‡ªç”±ä½¿ç”¨ï¼ŒLintæ£€æŸ¥

**æ‰§è¡Œå·¥å…·**:
7. `run_in_terminal` - ğŸ”´ é«˜é£é™©
   - âœ… å…è®¸: npm test, npm run lint
   - âš ï¸ æç¤º: npm install, git commit
   - ğŸ”´ ç¡®è®¤: rm -rf, git push, éƒ¨ç½²å‘½ä»¤
   - âŒ ç¦æ­¢: sudo, chmod 777

**ä¸“ä¸šä»£ç†å·¥å…·**:
8. `run_subagent` - ğŸŸ¡ å»ºè®®ä½¿ç”¨
   - codestral: ä»£ç ç”Ÿæˆå’Œé‡æ„
   - magistral: å¤æ‚æ¨ç†
   - pixtral: å›¾åƒåˆ†æ
   - mistral_large: æœ€å¤æ‚ä»»åŠ¡
   - è¦æ±‚: è®°å½•å®¡è®¡æ—¥å¿—ï¼Œè¯´æ˜ä½¿ç”¨åŸå› 

**æ•°æ®åº“å·¥å…·** (MCP):
9. `mcp_mongodb-chat_*` - ğŸ”´ æŒ‰æ“ä½œåˆ†çº§
   - âœ… æŸ¥è¯¢: find, count, list-*
   - ğŸ”´ å†™å…¥: insert-many, update-many
   - ğŸ”´ åˆ é™¤: delete-many, drop-*
   - âŒ ç¦æ­¢: drop-database (ç”Ÿäº§ç¯å¢ƒ)

---

#### 4. ç¦æ­¢é¡¹æ¸…å•

```yaml
ğŸ”´ æ˜ç¡®ç¦æ­¢:
  ç³»ç»Ÿçº§:
    - ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶
    - ä¿®æ”¹ç¯å¢ƒå˜é‡(æ°¸ä¹…)
    - ä¿®æ”¹ç”¨æˆ·æƒé™
  
  ç ´åæ€§(æœªç¡®è®¤):
    - åˆ é™¤æ–‡ä»¶/ç›®å½•
    - åˆ é™¤æ•°æ®åº“
    - git push -f
  
  æœªæˆæƒè®¿é—®:
    - è®¿é—®å¤–éƒ¨API(é™¤éProfileå…è®¸)
    - ä¸‹è½½å¤–éƒ¨èµ„æº
  
  éšç§ä¾µçŠ¯:
    - è¯»å–å¯†ç /å¯†é’¥
    - ä¸Šä¼ æ•æ„Ÿæ•°æ®
```

---

#### 5. å®¡è®¡æ—¥å¿—è¦æ±‚

**æ‰€æœ‰å·¥å…·è°ƒç”¨å¿…é¡»è®°å½•**:

```javascript
auditLog.push({
  step: 'STEP 9',
  action: 'åˆ›å»ºæ–‡ä»¶',
  tool: 'create_file',
  target: 'src/user-service.js',
  result: 'success',
  timestamp: Date.now(),
  details: { /* å¯é€‰è¯¦æƒ… */ }
});
```

**å…³é”®æ“ä½œå‘ç”¨æˆ·è¯´æ˜**:
- run_subagent: è¯´æ˜è°ƒç”¨äº†å“ªä¸ªä»£ç†ï¼Œä¸ºä»€ä¹ˆ
- run_in_terminal: è¯´æ˜æ‰§è¡Œäº†ä»€ä¹ˆå‘½ä»¤
- åˆ é™¤æ“ä½œ: åˆ—å‡ºåˆ é™¤çš„æ–‡ä»¶æ¸…å•

---

#### 6. Profileè¦†ç›–æœºåˆ¶

**é¡¹ç›®å¯ä»¥è‡ªå®šä¹‰å·¥å…·æƒé™**:

```yaml
# é«˜å®‰å…¨é¡¹ç›®
ç¦æ­¢å·¥å…·:
  - run_in_terminal: å®Œå…¨ç¦æ­¢
  - run_subagent: ä¸å…è®¸
  
# å¿«é€Ÿå¼€å‘é¡¹ç›®
æ”¾å®½é™åˆ¶:
  - run_in_terminal: npm installæ— éœ€ç¡®è®¤
  - create_file: é…ç½®æ–‡ä»¶æ— éœ€ç¡®è®¤
```

---

## âœ… é›†æˆä½ç½®

### 1. v3.md ä¸»è§„èŒƒæ›´æ–°

**ä½ç½®1: è§„èŒƒä½“ç³»æ¦‚è§ˆ**
```markdown
â”œâ”€â”€ ğŸ“ è§„åˆ™è§„èŒƒ (8ä¸ª)  # ä»7ä¸ªå˜ä¸º8ä¸ª
â”‚   â””â”€â”€ å·¥å…·è°ƒç”¨è§„èŒƒ - AIå·¥å…·ä½¿ç”¨æƒé™å’Œå®‰å…¨çº¦æŸ
```

**ä½ç½®2: ç›¸å…³è§„èŒƒæ–‡ä»¶**
```markdown
- ğŸ“ [å·¥å…·è°ƒç”¨è§„èŒƒ](../specs/rules/å·¥å…·è°ƒç”¨è§„èŒƒ.md) ğŸ”´ - AIå·¥å…·ä½¿ç”¨æƒé™å’Œå®‰å…¨çº¦æŸ
```

**ä½ç½®3: ä½ å¿…é¡»æŸ¥é˜…çš„è§„èŒƒæ–‡ä»¶**
```markdown
**ä»»ä½•æ—¶å€™ä½¿ç”¨å·¥å…·**: ä½ å¿…é¡»è¯»å–
- [å·¥å…·è°ƒç”¨è§„èŒƒ](../specs/rules/å·¥å…·è°ƒç”¨è§„èŒƒ.md) - ä½ ä½¿ç”¨å·¥å…·çš„æƒé™å’Œå®‰å…¨çº¦æŸï¼ˆå¿…è¯»ï¼‰
```

**ä½ç½®4: å®Œæ•´è§„èŒƒæ–‡ä»¶åˆ—è¡¨**
```markdown
### è§„åˆ™è§„èŒƒï¼ˆä½ ç”Ÿæˆå†…å®¹æ—¶å¿…é¡»éµå®ˆçš„è§„åˆ™ï¼‰
- [å·¥å…·è°ƒç”¨è§„èŒƒ](../specs/rules/å·¥å…·è°ƒç”¨è§„èŒƒ.md) - AIå·¥å…·ä½¿ç”¨æƒé™å’Œå®‰å…¨çº¦æŸï¼Œå¿…é¡»éµå®ˆ
```

---

## ğŸ“ˆ å½±å“è¯„ä¼°

### è§£å†³çš„é—®é¢˜

**ä¹‹å‰çš„é—®é¢˜** ğŸ”´:
- AIä¸ç¡®å®šèƒ½å¦ä½¿ç”¨å·¥å…·
- å·¥å…·ä½¿ç”¨æ²¡æœ‰å®‰å…¨çº¦æŸ
- æ•æ„Ÿæ“ä½œ(å¦‚åˆ é™¤)ç¼ºå°‘ä¿æŠ¤
- å·¥å…·ä½¿ç”¨ä¸é€æ˜ï¼Œç”¨æˆ·ä¸çŸ¥æƒ…
- è§„èŒƒä¸å®é™…å·¥å…·èƒ½åŠ›è„±èŠ‚

**ç°åœ¨çš„çŠ¶æ€** âœ…:
- AIæ˜ç¡®çŸ¥é“å“ªäº›å·¥å…·å¯ä»¥ä½¿ç”¨
- æ¯ä¸ªå·¥å…·éƒ½æœ‰æ¸…æ™°çš„ç¡®è®¤è¦æ±‚
- æ•æ„Ÿæ“ä½œå¿…é¡»P0ç¡®è®¤
- æ‰€æœ‰å·¥å…·è°ƒç”¨è®°å½•å®¡è®¡æ—¥å¿—
- è§„èŒƒè¦†ç›–33+ä¸ªå®é™…å·¥å…·

---

### è§„èŒƒè´¨é‡

**å®Œæ•´æ€§**: âœ… 9.5/10
- âœ… è¦†ç›–æ‰€æœ‰ä¸»è¦å·¥å…·ç±»åˆ«
- âœ… åŒ…å«ç¡®è®¤æœºåˆ¶
- âœ… åŒ…å«å®¡è®¡æ—¥å¿—è¦æ±‚
- âœ… åŒ…å«Profileè¦†ç›–
- âœ… åŒ…å«é”™è¯¯å¤„ç†
- ğŸŸ¡ å¯ä»¥æ ¹æ®å®é™…ä½¿ç”¨è¡¥å……æ›´å¤šå·¥å…·

**å¯æ‰§è¡Œæ€§**: âœ… 9/10
- âœ… æ¯ä¸ªå·¥å…·éƒ½æœ‰æ˜ç¡®çš„ä½¿ç”¨è§„åˆ™
- âœ… ç¡®è®¤çº§åˆ«æ¸…æ™°å¯åˆ¤æ–­
- âœ… Profileè¦†ç›–æœºåˆ¶æ˜ç¡®
- ğŸŸ¡ å®é™…æ‰§è¡Œéœ€è¦AIæ¡†æ¶æ”¯æŒ

**å®‰å…¨æ€§**: âœ… 10/10
- âœ… 4çº§ç¡®è®¤æœºåˆ¶
- âœ… ç¦æ­¢é¡¹æ¸…å•æ˜ç¡®
- âœ… æ•æ„Ÿæ“ä½œå¿…é¡»ç¡®è®¤
- âœ… å®¡è®¡æ—¥å¿—å®Œæ•´

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: STEP 9 ä»£ç ç”Ÿæˆ

```javascript
// AIæ‰§è¡Œæµç¨‹
async function step9_generateCode() {
  // 1. è¯»å–ç°æœ‰ä»£ç (çº§åˆ«0ï¼Œæ— éœ€ç¡®è®¤)
  const existingCode = await read_file({
    filePath: 'src/app.js',
    startLineNumberBaseZero: 0,
    endLineNumberBaseZero: 100
  });
  
  // 2. ç”Ÿæˆæ–°ä»£ç 
  const newCode = generateCode(existingCode);
  
  // 3. åˆ›å»ºæ–°æ–‡ä»¶(çº§åˆ«1ï¼Œè‡ªåŠ¨æ‰§è¡Œ)
  await create_file({
    filePath: 'src/user-service.js',
    content: newCode
  });
  
  // 4. è®°å½•å®¡è®¡æ—¥å¿—
  auditLog.push({
    step: 'STEP 9',
    action: 'åˆ›å»ºæ–‡ä»¶',
    tool: 'create_file',
    target: 'src/user-service.js',
    result: 'success',
    timestamp: Date.now()
  });
  
  // 5. Lintæ£€æŸ¥(çº§åˆ«0ï¼Œæ— éœ€ç¡®è®¤)
  const errors = await get_errors({
    filePaths: ['src/user-service.js']
  });
  
  if (errors.length > 0) {
    // ä¿®å¤é”™è¯¯...
  }
}
```

---

### ç¤ºä¾‹2: STEP 13 è¿è¡Œæµ‹è¯•

```javascript
async function step13_runTests() {
  // 1. è¿è¡Œæµ‹è¯•(çº§åˆ«1ï¼Œå®‰å…¨å‘½ä»¤)
  const result = await run_in_terminal({
    command: 'npm test',
    explanation: 'è¿è¡Œæµ‹è¯•éªŒè¯ä»£ç ',
    isBackground: false
  });
  
  // 2. è®°å½•å®¡è®¡æ—¥å¿—
  auditLog.push({
    step: 'STEP 13',
    action: 'è¿è¡Œæµ‹è¯•',
    tool: 'run_in_terminal',
    command: 'npm test',
    result: result.exitCode === 0 ? 'success' : 'failed',
    timestamp: Date.now()
  });
  
  return result;
}
```

---

### ç¤ºä¾‹3: å¤æ‚åˆ†æä½¿ç”¨subagent

```javascript
async function step5_complexAnalysis() {
  // è°ƒç”¨ä¸“ä¸šä»£ç†(çº§åˆ«1ï¼Œéœ€è®°å½•)
  const analysis = await run_subagent({
    agentName: 'magistral',
    task: 'åˆ†æç³»ç»Ÿæ¶æ„çš„æ€§èƒ½ç“¶é¢ˆå’Œå®‰å…¨é£é™©'
  });
  
  // è®°å½•å®¡è®¡æ—¥å¿—
  auditLog.push({
    step: 'STEP 5',
    action: 'è°ƒç”¨ä¸“ä¸šä»£ç†',
    tool: 'run_subagent',
    agent: 'magistral',
    task: 'ç³»ç»Ÿæ¶æ„åˆ†æ',
    timestamp: Date.now()
  });
  
  // åœ¨æŠ¥å‘Šä¸­è¯´æ˜
  report += `
## åˆ†ææ–¹æ³•

æœ¬æ¬¡åˆ†æä½¿ç”¨äº†Magistralä¸“ä¸šæ¨ç†ä»£ç†ï¼Œä»ä»¥ä¸‹è§’åº¦è¯„ä¼°:
1. æ€§èƒ½ç“¶é¢ˆè¯†åˆ«
2. å®‰å…¨é£é™©è¯„ä¼°
3. å¯æ‰©å±•æ€§åˆ†æ
  `;
  
  return analysis;
}
```

---

### ç¤ºä¾‹4: P0æ“ä½œéœ€è¦ç¡®è®¤

```javascript
async function step9_deleteFile() {
  // æ£€æŸ¥æ˜¯å¦åœ¨P0æ¸…å•ä¸­
  if (!userConfirmedP0Operations.includes('delete_old_config')) {
    throw new Error(
      'åˆ é™¤æ“ä½œéœ€è¦ç”¨æˆ·ç¡®è®¤ã€‚' +
      'è¯·åœ¨STEP 7çš„P0æ“ä½œæ¸…å•ä¸­æ˜ç¡®åˆ—å‡ºã€‚'
    );
  }
  
  // æ‰§è¡Œåˆ é™¤(çº§åˆ«3ï¼Œå·²ç¡®è®¤)
  await run_in_terminal({
    command: 'rm src/old-config.js',
    explanation: 'åˆ é™¤æ—§é…ç½®æ–‡ä»¶',
    isBackground: false
  });
  
  // è®°å½•å®¡è®¡æ—¥å¿—
  auditLog.push({
    step: 'STEP 9',
    action: 'åˆ é™¤æ–‡ä»¶',
    tool: 'run_in_terminal',
    command: 'rm src/old-config.js',
    confirmed: true,
    confirmedAt: 'STEP 7',
    timestamp: Date.now()
  });
}
```

---

## ğŸ‰ æ€»ç»“

### å·¥å…·è°ƒç”¨è§„èŒƒçš„ä»·å€¼

**1. å®‰å…¨æ€§æå‡** ğŸ”’
- æ˜ç¡®å“ªäº›æ“ä½œéœ€è¦ç¡®è®¤
- é˜²æ­¢AIè¿‡åº¦è‡ªåŠ¨åŒ–é€ æˆå±é™©
- P0æ“ä½œå¿…é¡»ç”¨æˆ·æ˜ç¡®åŒæ„

**2. é€æ˜åº¦æå‡** ğŸ‘ï¸
- æ‰€æœ‰å·¥å…·è°ƒç”¨è®°å½•å®¡è®¡æ—¥å¿—
- å…³é”®æ“ä½œå‘ç”¨æˆ·è¯´æ˜
- ç”¨æˆ·å¯ä»¥è¿½æº¯AIçš„æ‰€æœ‰è¡Œä¸º

**3. çµæ´»æ€§æå‡** ğŸ”§
- Profileå¯ä»¥è‡ªå®šä¹‰å·¥å…·æƒé™
- é€‚åº”ä¸åŒé¡¹ç›®çš„å®‰å…¨éœ€æ±‚
- å¯ä»¥é€æ­¥æ”¾å®½æˆ–æ”¶ç´§é™åˆ¶

**4. å¯æ‰§è¡Œæ€§æå‡** âš¡
- AIæ˜ç¡®çŸ¥é“èƒ½åšä»€ä¹ˆ
- æ¯ä¸ªå·¥å…·éƒ½æœ‰æ¸…æ™°çš„ä½¿ç”¨è§„åˆ™
- å‡å°‘AIçš„ä¸ç¡®å®šæ€§

---

### ä¸‹ä¸€æ­¥å»ºè®®

**çŸ­æœŸ** (å·²å®Œæˆ):
- âœ… åˆ›å»ºå·¥å…·è°ƒç”¨è§„èŒƒæ–‡ä»¶
- âœ… é›†æˆåˆ°v3ä¸»è§„èŒƒ
- âœ… æ›´æ–°å®¡æŸ¥æŠ¥å‘Š

**ä¸­æœŸ** (å»ºè®®):
- ğŸŸ¡ åœ¨å®é™…ä½¿ç”¨ä¸­éªŒè¯è§„èŒƒ
- ğŸŸ¡ æ ¹æ®åé¦ˆè¡¥å……æ›´å¤šå·¥å…·
- ğŸŸ¡ å®Œå–„Profileç¤ºä¾‹

**é•¿æœŸ** (è®¡åˆ’):
- ğŸŸ¢ å¼€å‘è‡ªåŠ¨åŒ–éªŒè¯å·¥å…·
- ğŸŸ¢ å»ºç«‹å·¥å…·ä½¿ç”¨æœ€ä½³å®è·µ
- ğŸŸ¢ æ”¶é›†å·¥å…·ä½¿ç”¨ç»Ÿè®¡æ•°æ®

---

**æŠ¥å‘Šå®Œæˆ**: 2025-11-21  
**è§„èŒƒçŠ¶æ€**: âœ… å·²æŠ•å…¥ä½¿ç”¨  
**ä¸‹ä¸€ä¸ªP0**: è¡¥å……å¾ªç¯æ§åˆ¶æœºåˆ¶å’ŒçŠ¶æ€æŒä¹…åŒ–ç­–ç•¥

