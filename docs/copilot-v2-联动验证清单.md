# copilot-instructions.md 与 v2.md 联动验证清单

> **验证日期**: 2025-11-10  
> **验证人**: AI 助手  
> **验证目的**: 确保两个文件的"场景 0"内容保持一致

---

## ✅ 验证清单

### 1. copilot-instructions.md 检查

| 检查项 | 状态 | 位置 |
|--------|------|------|
| ✅ 决策流程包含"场景 0" | 通过 | 快速决策流程 [0] |
| ✅ 明确"项目规范 > 通用实践" | 通过 | 核心原则章节 |
| ✅ 新增"场景 0：项目规范强制检查" | 通过 | 场景触发器章节 |
| ✅ 新增"阶段 0：项目规范确认" | 通过 | 执行检查清单章节 |
| ✅ 新增"项目规范违规"禁止项 | 通过 | 禁止操作清单章节 |
| ✅ 5个核心问题自我检查 | 通过 | 场景 0 STEP 5 |

### 2. v2.md 检查

| 检查项 | 状态 | 位置 |
|--------|------|------|
| ✅ 立即执行规则包含"第0优先级" | 通过 | AI 执行速查章节 |
| ✅ 关键决策点包含"场景0" | 通过 | AI 执行速查章节 |
| ✅ 新增"场景 0：项目规范强制检查" | 通过 | AI 决策指南章节 |
| ✅ 目录包含"场景 0"链接 | 通过 | 目录章节 |
| ✅ 引用 copilot-instructions.md | 通过 | 场景 0 详细规范部分 |

### 3. profiles/chat.md 检查

| 检查项 | 状态 | 位置 |
|--------|------|------|
| ✅ 新增"架构与技术栈强制规范"章节 | 通过 | MCP 配置前 |
| ✅ 明确禁止 Service 层 | 通过 | 架构层次禁止项 |
| ✅ 明确强制 Joi | 通过 | 参数验证强制规范 |
| ✅ 明确强制 Mocha | 通过 | 测试框架强制规范 |
| ✅ 明确强制 utilsCrud | 通过 | 数据库操作强制规范 |
| ✅ 明确强制中文注释 | 通过 | 注释语言强制规范 |
| ✅ 提供正确/错误示例 | 通过 | 每个规范下 |

### 4. 联动关系检查

| 检查项 | 状态 | 说明 |
|--------|------|------|
| ✅ copilot-instructions.md 引用 v2.md | 通过 | 场景A-E都有章节引用 |
| ✅ v2.md 引用 copilot-instructions.md | 通过 | 场景0详细规范引用 |
| ✅ v2.md 引用 profiles/ | 通过 | 场景0详细规范引用 |
| ✅ 优先级链条完整 | 通过 | Profile > copilot > v2 > 通用 |

### 5. 文档一致性检查

| 检查项 | 状态 | 说明 |
|--------|------|------|
| ✅ 场景编号一致 | 通过 | 场景0-E都对应 |
| ✅ 强制规范表述一致 | 通过 | 禁止项表述相同 |
| ✅ 自我检查机制一致 | 通过 | 5个核心问题相同 |
| ✅ 冲突解决规则一致 | 通过 | 项目规范优先 |

---

## 📊 联动关系图

```
用户请求
    ↓
copilot-instructions.md (快速决策)
    ├─ [0] 🔴 读取项目 Profile ──────────┐
    ├─ [0.1] 识别禁止项                │
    ├─ [0.2] 项目规范 > 通用实践       │
    ↓                                  │
场景识别                              │
    ├─ 场景 0: 项目规范检查 ───→ v2.md 场景0 ───┐
    ├─ 场景 A: 功能新增 ───→ v2.md 第3.1章      │
    ├─ 场景 B: Bug修复 ───→ v2.md Bug模板       │
    ├─ 场景 C: 大规模编辑 ───→ v2.md 第20章     │
    ├─ 场景 D: 代码审查 ───→ v2.md 第9/10章     │
    └─ 场景 E: 文档更新 ───→ v2.md 第6章        │
    ↓                                           │
执行检查清单                                    │
    ├─ 阶段 0: 项目规范确认 🔴 ←────────────────┘
    ├─ 阶段 1: 任务开始前 ──→ 读取 Profile ←──────┘
    ├─ 阶段 2: 代码修改时
    ├─ 阶段 3: 测试与示例
    ├─ 阶段 4: 文档更新
    └─ 阶段 5: 提交前验证
    ↓
profiles/<project>.md (项目特定配置)
    ├─ 架构与技术栈强制规范 🔴
    ├─ 禁止项清单（Service/DTO/Jest）
    ├─ 强制项清单（Joi/Mocha/utilsCrud）
    └─ 正确/错误示例
```

---

## 🔍 关键同步点

### 同步点 1: 场景 0 定义

| 文件 | 章节 | 内容 |
|------|------|------|
| copilot-instructions.md | 场景 0 | 详细的5步执行流程 |
| v2.md | 场景 0 | 简化的5步执行流程（引用copilot） |
| 一致性 | ✅ 通过 | 核心步骤相同，v2.md引用详细版 |

### 同步点 2: 优先级声明

| 文件 | 位置 | 表述 |
|------|------|------|
| copilot-instructions.md | 核心原则 | "项目 Profile 🔴 > copilot-instructions.md 🟠 > 通用最佳实践 🟡" |
| v2.md | 立即执行规则 | "项目规范 > 通用最佳实践" |
| 一致性 | ✅ 通过 | 优先级顺序一致 |

### 同步点 3: 自我检查机制

| 文件 | 位置 | 核心问题数量 |
|------|------|------------|
| copilot-instructions.md | 场景 0 STEP 5 | 5个问题 |
| v2.md | 场景 0 STEP 5 | 5个问题 |
| 一致性 | ✅ 通过 | 问题完全相同 |

### 同步点 4: 禁止项清单

| 文件 | 位置 | 禁止项数量 |
|------|------|----------|
| copilot-instructions.md | 禁止操作清单 | 6项 |
| v2.md | 场景 0 禁止行为 | 5项 |
| 一致性 | ✅ 通过 | 核心禁止项一致 |

---

## 🎯 后续维护建议

### 1. 修改同步规则

**规则**: 修改其中一个文件时，必须同步更新另一个文件

| 修改类型 | 同步要求 | 检查清单 |
|---------|---------|---------|
| 新增场景 | 🔴 必须同步 | copilot-instructions.md + v2.md + 目录 |
| 修改场景规则 | 🔴 必须同步 | 两个文件的场景描述 |
| 新增检查清单 | 🔴 必须同步 | 两个文件的阶段定义 |
| 修改优先级 | 🔴 必须同步 | 两个文件的优先级声明 |
| 新增禁止项 | 🟠 建议同步 | 两个文件的禁止清单 |

### 2. 定期一致性检查

**建议频率**: 每次修改后立即检查

**检查脚本**（待实现）:
```powershell
# scripts/verify/check-guidelines-sync.ps1
# 检查 copilot-instructions.md 和 v2.md 的关键章节是否一致
```

### 3. 版本号管理

| 文件 | 当前版本 | 更新时间 |
|------|---------|---------|
| copilot-instructions.md | v2.1 | 2025-11-10 |
| v2.md | v2.0 → v2.1 | 2025-11-10（本次更新）|
| 建议 | 同步版本号 | 每次重大更新时同步 |

---

## ✅ 验证结论

**状态**: 🟢 通过

**总体一致性**: ✅ 优秀

**关键发现**:
1. ✅ 所有关键章节已同步
2. ✅ 引用关系完整
3. ✅ 优先级链条清晰
4. ✅ 禁止项/强制项一致

**后续行动**:
- [ ] 其他项目 Profile（user/push/resource/search/payment）也需要添加"架构与技术栈强制规范"
- [ ] 考虑创建自动化检查脚本
- [ ] 定期审查两个文件的一致性

---

**验证人**: AI 助手  
**验证时间**: 2025-11-10  
**下次检查**: 下次修改规范时

